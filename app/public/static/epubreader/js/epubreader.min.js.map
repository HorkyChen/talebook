{"version":3,"file":"js/epubreader.min.js","mappings":"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","sources":["webpack://epubreader-js/./node_modules/es5-ext/function/noop.js","webpack://epubreader-js/./node_modules/event-emitter/index.js","webpack://epubreader-js/./node_modules/type/function/is.js","webpack://epubreader-js/./node_modules/es5-ext/object/keys/index.js","webpack://epubreader-js/./node_modules/es5-ext/object/valid-value.js","webpack://epubreader-js/./node_modules/es5-ext/object/normalize-options.js","webpack://epubreader-js/./node_modules/type/value/is.js","webpack://epubreader-js/./node_modules/type/object/is.js","webpack://epubreader-js/./node_modules/type/prototype/is.js","webpack://epubreader-js/./node_modules/es5-ext/string/\u0000#/contains/index.js","webpack://epubreader-js/./node_modules/es5-ext/object/keys/shim.js","webpack://epubreader-js/./node_modules/d/index.js","webpack://epubreader-js/./node_modules/es5-ext/object/assign/is-implemented.js","webpack://epubreader-js/./node_modules/es5-ext/object/keys/is-implemented.js","webpack://epubreader-js/./node_modules/es5-ext/object/valid-callable.js","webpack://epubreader-js/./node_modules/es5-ext/string/\u0000#/contains/shim.js","webpack://epubreader-js/./node_modules/es5-ext/string/\u0000#/contains/is-implemented.js","webpack://epubreader-js/./node_modules/es5-ext/object/assign/shim.js","webpack://epubreader-js/./node_modules/es5-ext/object/assign/index.js","webpack://epubreader-js/./node_modules/es5-ext/object/is-value.js","webpack://epubreader-js/./node_modules/type/plain-function/is.js","webpack://epubreader-js/webpack/bootstrap","webpack://epubreader-js/./src/utils.js","webpack://epubreader-js/./src/storage.js","webpack://epubreader-js/./src/strings.js","webpack://epubreader-js/./src/ui.js","webpack://epubreader-js/./src/toolbar.js","webpack://epubreader-js/./src/content.js","webpack://epubreader-js/./src/sidebar/toc.js","webpack://epubreader-js/./src/sidebar/bookmarks.js","webpack://epubreader-js/./src/sidebar/annotations.js","webpack://epubreader-js/./src/sidebar/search.js","webpack://epubreader-js/./src/sidebar/settings.js","webpack://epubreader-js/./src/sidebar/metadata.js","webpack://epubreader-js/./src/sidebar.js","webpack://epubreader-js/./src/notedlg.js","webpack://epubreader-js/./src/reader.js"],"sourcesContent":["\"use strict\";\n\n// eslint-disable-next-line no-empty-function\nmodule.exports = function () {};\n","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n","\"use strict\";\n\nvar isPrototype = require(\"../prototype/is\");\n\nmodule.exports = function (value) {\n\tif (typeof value !== \"function\") return false;\n\n\tif (!hasOwnProperty.call(value, \"length\")) return false;\n\n\ttry {\n\t\tif (typeof value.length !== \"number\") return false;\n\t\tif (typeof value.call !== \"function\") return false;\n\t\tif (typeof value.apply !== \"function\") return false;\n\t} catch (error) {\n\t\treturn false;\n\t}\n\n\treturn !isPrototype(value);\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.keys : require(\"./shim\");\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\n// eslint-disable-next-line no-unused-vars\nmodule.exports = function (opts1 /*, …options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (!isValue(options)) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n","\"use strict\";\n\n// ES3 safe\nvar _undefined = void 0;\n\nmodule.exports = function (value) { return value !== _undefined && value !== null; };\n","\"use strict\";\n\nvar isValue = require(\"../value/is\");\n\n// prettier-ignore\nvar possibleTypes = { \"object\": true, \"function\": true, \"undefined\": true /* document.all */ };\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) return false;\n\treturn hasOwnProperty.call(possibleTypes, typeof value);\n};\n","\"use strict\";\n\nvar isObject = require(\"../object/is\");\n\nmodule.exports = function (value) {\n\tif (!isObject(value)) return false;\n\ttry {\n\t\tif (!value.constructor) return false;\n\t\treturn value.constructor.prototype === value;\n\t} catch (error) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? String.prototype.contains : require(\"./shim\");\n","\"use strict\";\n\nvar isValue = require(\"../is-value\");\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) { return keys(isValue(object) ? Object(object) : object); };\n","\"use strict\";\n\nvar isValue         = require(\"type/value/is\")\n  , isPlainFunction = require(\"type/plain-function/is\")\n  , assign          = require(\"es5-ext/object/assign\")\n  , normalizeOpts   = require(\"es5-ext/object/normalize-options\")\n  , contains        = require(\"es5-ext/string/#/contains\");\n\nvar d = (module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif (arguments.length < 2 || typeof dscr !== \"string\") {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t\tw = contains.call(dscr, \"w\");\n\t} else {\n\t\tc = w = true;\n\t\te = false;\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n});\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== \"string\") {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (!isValue(get)) {\n\t\tget = undefined;\n\t} else if (!isPlainFunction(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (!isValue(set)) {\n\t\tset = undefined;\n\t} else if (!isPlainFunction(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t} else {\n\t\tc = true;\n\t\te = false;\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== \"function\") return false;\n\tobj = { foo: \"raz\" };\n\tassign(obj, { bar: \"dwa\" }, { trzy: \"trzy\" });\n\treturn obj.foo + obj.bar + obj.trzy === \"razdwatrzy\";\n};\n","\"use strict\";\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys(\"primitive\");\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== \"function\") throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n","\"use strict\";\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString /*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n","\"use strict\";\n\nvar str = \"razdwatrzy\";\n\nmodule.exports = function () {\n\tif (typeof str.contains !== \"function\") return false;\n\treturn str.contains(\"dwa\") === true && str.contains(\"foo\") === false;\n};\n","\"use strict\";\n\nvar keys  = require(\"../keys\")\n  , value = require(\"../valid-value\")\n  , max   = Math.max;\n\nmodule.exports = function (dest, src /*, …srcn*/) {\n\tvar error, i, length = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry {\n\t\t\tdest[key] = src[key];\n\t\t} catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < length; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.assign : require(\"./shim\");\n","\"use strict\";\n\nvar _undefined = require(\"../function/noop\")(); // Support ES3 engines\n\nmodule.exports = function (val) { return val !== _undefined && val !== null; };\n","\"use strict\";\n\nvar isFunction = require(\"../function/is\");\n\nvar classRe = /^\\s*class[\\s{/}]/, functionToString = Function.prototype.toString;\n\nmodule.exports = function (value) {\n\tif (!isFunction(value)) return false;\n\tif (classRe.test(functionToString.call(value))) return false;\n\treturn true;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const d = (obj, prop) => obj ? obj[prop] : undefined\n\nconst q = (src, dst, ext, prop) => {\n    let val\n    if (typeof dst[prop] === \"boolean\") {\n        switch (prop) {\n            case \"annotations\":\n            case \"bookmarks\":\n                val = dst[prop] ? src[prop] : dst[prop]\n                break;\n            default:\n                val = dst[prop]\n                break;\n        }\n    } else if (prop === \"arrows\") {\n        val = dst[prop]\n    } else {\n        val = d(ext, prop) === undefined ? src[prop] : dst[prop]\n    }\n    return val\n}\n\nexport const extend = (src, dst, ext) => {\n    for (let prop in src) {\n        if (prop === \"bookPath\") {\n            continue\n        } else if (dst[prop] instanceof Array) {\n            dst[prop] = ext ? (src[prop] ? src[prop] : dst[prop]) : src[prop]\n        } else if (dst[prop] instanceof Object) {\n            extend(src[prop], dst[prop], d(ext, prop)) // recursive call\n        } else {\n            dst[prop] = ext ? q(src, dst, ext, prop) : src[prop]\n        }\n    }\n}\n\nexport const uuid = () => {\n    let d = new Date().getTime()\n    const uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, (c) => {\n        let r = (d + Math.random() * 16) % 16 | 0\n        d = Math.floor(d / 16)\n        return (c === \"x\" ? r : (r & 0x7 | 0x8)).toString(16)\n    })\n    return uuid\n}\n\nexport const detectMobile = () => {\n    const matches = [\n        /Android/i,\n        /BlackBerry/i,\n        /iPhone/i,\n        /iPad/i,\n        /iPod/i,\n        /Windows Phone/i,\n        /webOS/i\n    ]\n    return matches.some((i) => navigator.userAgent.match(i))\n}","export class Storage {\n\n\tconstructor() {\n\n\t\tthis.name = \"epubreader-js\";\n\t\tthis.version = 1.0;\n\t\tthis.db;\n\t\tthis.indexedDB = window.indexedDB ||\n\t\t\twindow.webkitIndexedDB ||\n\t\t\twindow.mozIndexedDB ||\n\t\t\twindow.OIndexedDB ||\n\t\t\twindow.msIndexedDB;\n\n\t\tif (this.indexedDB === undefined) {\n\n\t\t\tconsole.error(\"The IndexedDB API not available in your browser.\");\n\t\t}\n\t}\n\n\tinit(callback) {\n\n\t\tif (this.indexedDB === undefined) {\n\t\t\tcallback();\n\t\t\treturn;\n\t\t}\n\n\t\tconst time = Date.now();\n\t\tconst onerror = (e) => console.error(\"IndexedDB\", e);\n\t\tconst request = indexedDB.open(this.name, this.version);\n\t\trequest.onupgradeneeded = (e) => {\n\n\t\t\tconst db = e.target.result;\n\t\t\tif (db.objectStoreNames.contains(\"entries\") === false) {\n\t\t\t\tdb.createObjectStore(\"entries\");\n\t\t\t}\n\t\t}\n\n\t\trequest.onsuccess = (e) => {\n\n\t\t\tthis.db = e.target.result;\n\t\t\tthis.db.onerror = onerror;\n\t\t\tcallback();\n\t\t\tconsole.log(`storage.init: ${Date.now() - time} ms`);\n\t\t}\n\n\t\trequest.onerror = onerror;\n\t}\n\n\tget(callback) {\n\n\t\tif (this.db === undefined) {\n\t\t\tcallback();\n\t\t\treturn;\n\t\t}\n\n\t\tconst time = Date.now();\n\t\tconst transaction = this.db.transaction([\"entries\"], \"readwrite\");\n\t\tconst objectStore = transaction.objectStore(\"entries\");\n\t\tconst request = objectStore.get(0);\n\t\trequest.onsuccess = (e) => {\n\n\t\t\tcallback(e.target.result);\n\t\t\tconsole.log(`storage.get: ${Date.now() - time} ms`);\n\t\t}\n\t}\n\n\tset(data, callback) {\n\n\t\tif (this.db === undefined) {\n\t\t\tcallback();\n\t\t\treturn;\n\t\t}\n\n\t\tconst time = Date.now();\n\t\tconst transaction = this.db.transaction([\"entries\"], \"readwrite\");\n\t\tconst objectStore = transaction.objectStore(\"entries\");\n\t\tconst request = objectStore.put(data, 0);\n\t\trequest.onsuccess = () => {\n\n\t\t\tcallback();\n\t\t\tconsole.log(`storage.set: ${Date.now() - time} ms`);\n\t\t}\n\t}\n\n\tclear() {\n\n\t\tif (this.db === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst time = Date.now();\n\t\tconst transaction = this.db.transaction([\"entries\"], \"readwrite\");\n\t\tconst objectStore = transaction.objectStore(\"entries\");\n\t\tconst request = objectStore.clear();\n\t\trequest.onsuccess = () => {\n\n\t\t\tconsole.log(`storage.clear: ${Date.now() - time} ms`);\n\t\t}\n\t}\n}","export class Strings {\n\n\tconstructor(reader) {\n\n\t\tthis.language = reader.settings.language || \"en\";\n\t\tthis.values = {\n\t\t\ten: {\n\t\t\t\t\"toolbar/sidebar\": \"Sidebar\",\n\t\t\t\t\"toolbar/prev\": \"Previous page\",\n\t\t\t\t\"toolbar/next\": \"Next page\",\n\t\t\t\t\"toolbar/openbook\": \"Open book\",\n\t\t\t\t\"toolbar/openbook/error\": \"Your browser does not support the required features.\\nPlease use a modern browser such as Google Chrome, or Mozilla Firefox.\",\n\t\t\t\t\"toolbar/bookmark\": \"Add this page to bookmarks\",\n\t\t\t\t\"toolbar/fullscreen\": \"Fullscreen\",\n\n\t\t\t\t\"sidebar/close\": \"Close Sidebar\",\n\t\t\t\t\"sidebar/contents\": \"Contents\",\n\t\t\t\t\"sidebar/bookmarks\": \"Bookmarks\",\n\t\t\t\t\"sidebar/bookmarks/add\": \"Add\",\n\t\t\t\t\"sidebar/bookmarks/remove\": \"Remove\",\n\t\t\t\t\"sidebar/bookmarks/clear\": \"Clear\",\n\t\t\t\t\"sidebar/annotations\": \"Annotations\",\n\t\t\t\t\"sidebar/annotations/add\": \"Add\",\n\t\t\t\t\"sidebar/annotations/remove\": \"Remove\",\n\t\t\t\t\"sidebar/annotations/clear\": \"Clear\",\n\t\t\t\t\"sidebar/annotations/anchor\": \"Anchor\",\n\t\t\t\t\"sidebar/annotations/cancel\": \"Cancel\",\n\t\t\t\t\"sidebar/search\": \"Search\",\n\t\t\t\t\"sidebar/search/placeholder\": \"Search\",\n\t\t\t\t\"sidebar/settings\": \"Settings\",\n\t\t\t\t\"sidebar/settings/language\": \"Language\",\n\t\t\t\t\"sidebar/settings/font\": \"Font\",\n\t\t\t\t\"sidebar/settings/font/default\": \"Default\",\n\t\t\t\t\"sidebar/settings/fontsize\": \"Font size (%)\",\n\t\t\t\t\"sidebar/settings/flow\": \"Flow\",\n\t\t\t\t\"sidebar/settings/pagination\": [\"Pagination\", \"Generate pagination\"],\n\t\t\t\t\"sidebar/settings/spread\": \"Spread\",\n\t\t\t\t\"sidebar/settings/spread/items\": [\"None\", \"Auto\"],\n\t\t\t\t\"sidebar/settings/spread/minwidth\": \"Minimum spread width\",\n\t\t\t\t\"sidebar/settings/theme\": \"Theme\",\n\t\t\t\t\"sidebar/settings/theme/items\": [\"Light\", \"Dark\", \"Eye Care\"],\n\t\t\t\t\"sidebar/metadata\": \"Metadata\",\n\t\t\t\t\"sidebar/metadata/title\": \"Title\",\n\t\t\t\t\"sidebar/metadata/creator\": \"Creator\",\n\t\t\t\t\"sidebar/metadata/description\": \"Description\",\n\t\t\t\t\"sidebar/metadata/pubdate\": \"Pubdate\",\n\t\t\t\t\"sidebar/metadata/publisher\": \"Publisher\",\n\t\t\t\t\"sidebar/metadata/identifier\": \"Identifier\",\n\t\t\t\t\"sidebar/metadata/language\": \"Language\",\n\t\t\t\t\"sidebar/metadata/rights\": \"Rights\",\n\t\t\t\t\"sidebar/metadata/modified_date\": \"Modified date\",\n\t\t\t\t\"sidebar/metadata/layout\": \"Layout\", // rendition:layout\n\t\t\t\t\"sidebar/metadata/flow\": \"Flow\", // rendition:flow\n\t\t\t\t\"sidebar/metadata/spread\": \"Spread\", // rendition:spread\n\t\t\t\t\"sidebar/metadata/direction\": \"Direction\", // page-progression-direction\n\n\t\t\t\t\"notedlg/label\": \"Note\",\n\t\t\t\t\"notedlg/add\": \"Add\"\n\t\t\t},\n\t\t\tzh: {\n\t\t\t\t\"toolbar/sidebar\": \"侧边栏\",\n\t\t\t\t\"toolbar/prev\": \"上一页\",\n\t\t\t\t\"toolbar/next\": \"下一页\",\n\t\t\t\t\"toolbar/openbook\": \"打开书籍\",\n\t\t\t\t\"toolbar/openbook/error\": \"您的浏览器不支持所需功能。\\n请使用现代浏览器如谷歌Chrome或火狐Firefox。\",\n\t\t\t\t\"toolbar/bookmark\": \"加为书签\",\n\t\t\t\t\"toolbar/fullscreen\": \"全屏\",\n\n\t\t\t\t\"sidebar/close\": \"关闭侧边栏\",\n\t\t\t\t\"sidebar/contents\": \"目录\",\n\t\t\t\t\"sidebar/bookmarks\": \"书签\",\n\t\t\t\t\"sidebar/bookmarks/add\": \"添加\",\n\t\t\t\t\"sidebar/bookmarks/remove\": \"移除\",\n\t\t\t\t\"sidebar/bookmarks/clear\": \"清空\",\n\t\t\t\t\"sidebar/annotations\": \"注解\",\n\t\t\t\t\"sidebar/annotations/add\": \"添加\",\n\t\t\t\t\"sidebar/annotations/remove\": \"移除\",\n\t\t\t\t\"sidebar/annotations/clear\": \"清空\",\n\t\t\t\t\"sidebar/annotations/anchor\": \"锚定\",\n\t\t\t\t\"sidebar/annotations/cancel\": \"取消\",\n\n\t\t\t\t\"sidebar/search\": \"搜索\",\n\t\t\t\t\"sidebar/search/placeholder\": \"搜索\",\n\t\t\t\t\"sidebar/settings\": \"设置\",\n\t\t\t\t\"sidebar/settings/language\": \"语言\",\n\t\t\t\t\"sidebar/settings/font\": \"字体\",\n\t\t\t\t\"sidebar/settings/font/default\": \"默认字体\",\n\t\t\t\t\"sidebar/settings/fontsize\": \"字体大小 (%)\",\n\t\t\t\t\"sidebar/settings/flow\": \"换页\", // Scrolled = \"滚动模式\"\n\t\t\t\t\"sidebar/settings/pagination\": [\"分页模式\", \"滚动模式\"],\n\t\t\t\t\"sidebar/settings/spread\": \"双页布局\",\n\t\t\t\t\"sidebar/settings/spread/items\": [\"无\", \"自动\"],\n\t\t\t\t\"sidebar/settings/spread/minwidth\": \"最小双页宽度\",\n\t\t\t\t\"sidebar/settings/theme\": \"颜色主题\",\n\t\t\t\t\"sidebar/settings/theme/items\": [\"亮色\", \"暗色\", \"护眼\"],\n\t\t\t\t\"sidebar/metadata\": \"元数据\",\n\t\t\t\t\"sidebar/metadata/title\": \"标题\",\n\t\t\t\t\"sidebar/metadata/creator\": \"作者\",\n\t\t\t\t\"sidebar/metadata/description\": \"描述\",\n\t\t\t\t\"sidebar/metadata/pubdate\": \"出版日期\",\n\t\t\t\t\"sidebar/metadata/publisher\": \"出版商\",\n\t\t\t\t\"sidebar/metadata/identifier\": \"标识符\",\n\t\t\t\t\"sidebar/metadata/language\": \"语言\",\n\t\t\t\t\"sidebar/metadata/rights\": \"版权\",\n\t\t\t\t\"sidebar/metadata/modified_date\": \"修改日期\",\n\t\t\t\t\"sidebar/metadata/layout\": \"布局\",  // rendition:layout\n\t\t\t\t\"sidebar/metadata/flow\": \"流模式\",  // rendition:flow\n\t\t\t\t\"sidebar/metadata/spread\": \"双页布局\",  // rendition:spread\n\t\t\t\t\"sidebar/metadata/direction\": \"阅读方向\",  // page-progression-direction\n\n\t\t\t\t\"notedlg/label\": \"笔记\",\n\t\t\t\t\"notedlg/add\": \"添加\"\n\t\t\t},\n\t\t};\n\n\t\treader.on(\"languagechanged\", (value) => {\n\t\t\tthis.language = value;\n\t\t});\n\t}\n\n\tget(key) { return this.values[this.language][key] || \"???\"; }\n}","/**\n * @author mrdoob https://github.com/mrdoob/ui.js\n */\n\nconst ERROR_MSG = \"is not an instance of UIElement.\";\n\n/**\n * UIElement\n * @param {string} tag\n */\nexport class UIElement {\n\n\tconstructor(tag) {\n\n\t\tthis.dom = document.createElement(tag);\n\t}\n\n\tadd() {\n\n\t\tfor (let i = 0; i < arguments.length; i++) {\n\n\t\t\tconst argument = arguments[i];\n\n\t\t\tif (argument instanceof UIElement) {\n\n\t\t\t\tthis.dom.appendChild(argument.dom);\n\n\t\t\t} else if (Array.isArray(argument)) {\n\n\t\t\t\tfor (let j = 0; j < argument.length; j++) {\n\n\t\t\t\t\tconst element = argument[j];\n\n\t\t\t\t\tif (element instanceof UIElement) {\n\n\t\t\t\t\t\tthis.dom.appendChild(element.dom);\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.error(\"UIElement:\", element, ERROR_MSG);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\n\t\t\t\tconsole.error(\"UIElement:\", argument, ERROR_MSG);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tremove() {\n\n\t\tfor (let i = 0; i < arguments.length; i++) {\n\n\t\t\tconst argument = arguments[i];\n\n\t\t\tif (argument instanceof UIElement) {\n\n\t\t\t\tthis.dom.removeChild(argument.dom);\n\n\t\t\t} else if (Number.isInteger(argument)) {\n\n\t\t\t\tthis.dom.removeChild(this.dom.childNodes[argument]);\n\t\t\t} else {\n\n\t\t\t\tconsole.error(\"UIElement:\", argument, ERROR_MSG);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tclear() {\n\n\t\twhile (this.dom.children.length) {\n\n\t\t\tthis.dom.removeChild(this.dom.lastChild);\n\t\t}\n\t\treturn this;\n\t}\n\n\tsetId(id) {\n\n\t\tthis.dom.id = id;\n\t\treturn this;\n\t}\n\n\tgetId() {\n\n\t\treturn this.dom.id;\n\t}\n\n\tremoveAttribute(name) {\n\n\t\tthis.dom.removeAttribute(name);\n\t\treturn this;\n\t}\n\n\tsetClass(name) {\n\n\t\tthis.dom.className = name;\n\t\treturn this;\n\t}\n\n\taddClass(name) {\n\n\t\tthis.dom.classList.add(name);\n\t\treturn this;\n\t}\n\n\tremoveClass(name) {\n\n\t\tthis.dom.classList.remove(name);\n\t\treturn this;\n\t}\n\n\tsetStyle(key, value) {\n\n\t\tthis.dom.style[key] = value;\n\t\treturn this;\n\t}\n\n\tgetTitle() {\n\n\t\treturn this.dom.title;\n\t}\n\n\tsetTitle(title) {\n\n\t\tif (this.dom.title !== title && title)\n\t\t\tthis.dom.title = title;\n\t\treturn this;\n\t}\n\n\tgetTextContent() {\n\n\t\treturn this.dom.textContent;\n\t}\n\n\tsetTextContent(text) {\n\n\t\tif (this.dom.textContent !== text && text)\n\t\t\tthis.dom.textContent = text;\n\t\treturn this;\n\t}\n\n\tgetBoundingClientRect() {\n\n\t\treturn this.dom.getBoundingClientRect();\n\t}\n}\n\n/**\n * UISpan\n * @param {string} text\n */\nexport class UISpan extends UIElement {\n\n\tconstructor(text) {\n\n\t\tsuper(\"span\");\n\t\tthis.setTextContent(text);\n\t}\n}\n\n/**\n * UIDiv\n */\nexport class UIDiv extends UIElement {\n\n\tconstructor() {\n\n\t\tsuper(\"div\");\n\t}\n}\n\n/**\n * UIRow\n */\nexport class UIRow extends UIDiv {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.dom.className = \"row\";\n\t}\n}\n\n/**\n * UIPanel\n */\nexport class UIPanel extends UIDiv {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.dom.className = \"panel\";\n\t}\n}\n\n/**\n * UILabel\n * @param {string} text\n * @param {string} id\n */\nexport class UILabel extends UIElement {\n\n\tconstructor(text, id) {\n\n\t\tsuper(\"label\");\n\n\t\tthis.dom.textContent = text;\n\t\tif (id) this.dom.htmlFor = id;\n\t}\n}\n\n/**\n * UILink\n * @param {string} href\n * @param {string} text\n */\nexport class UILink extends UIElement {\n\n\tconstructor(href, text) {\n\n\t\tsuper(\"a\");\n\n\t\tthis.dom.href = href || \"#\";\n\t\tthis.dom.textContent = text || \"\";\n\t}\n\n\tsetHref(url) {\n\n\t\tthis.dom.href = url;\n\t\treturn this;\n\t}\n}\n\n/**\n * UIText\n * @param {string} text\n */\nexport class UIText extends UISpan {\n\n\tconstructor(text) {\n\n\t\tsuper();\n\n\t\tthis.dom.textContent = text;\n\t}\n\n\tgetValue() {\n\n\t\treturn this.dom.textContent;\n\t}\n\n\tsetValue(text) {\n\n\t\tthis.dom.textContent = text;\n\t\treturn this;\n\t}\n}\n\n/**\n * UITextArea\n */\nexport class UITextArea extends UIElement {\n\n\tconstructor() {\n\n\t\tsuper(\"textarea\");\n\n\t\tthis.dom.spellcheck = false;\n\t\tthis.dom.onkeydown = (e) => {\n\n\t\t\te.stopPropagation();\n\t\t};\n\t}\n\n\tgetValue() {\n\n\t\treturn this.dom.value;\n\t}\n\n\tsetValue(value) {\n\n\t\tthis.dom.value = value;\n\t\treturn this;\n\t}\n}\n\n/**\n * UISelect\n */\nexport class UISelect extends UIElement {\n\n\tconstructor() {\n\n\t\tsuper(\"select\");\n\t}\n\n\tsetMultiple(boolean) {\n\n\t\tthis.dom.multiple = boolean || false;\n\t\treturn this;\n\t}\n\n\tsetOptions(options) {\n\n\t\tconst selected = this.dom.value;\n\t\tthis.clear();\n\n\t\tfor (const key in options) {\n\n\t\t\tconst option = document.createElement(\"option\");\n\t\t\toption.value = key;\n\t\t\toption.text = options[key];\n\t\t\tthis.dom.appendChild(option);\n\t\t}\n\t\tthis.dom.value = selected;\n\t\treturn this;\n\t}\n\n\tgetValue() {\n\n\t\treturn this.dom.value;\n\t}\n\n\tsetValue(value) {\n\n\t\tvalue = String(value);\n\n\t\tif (this.dom.value !== value)\n\t\t\tthis.dom.value = value;\n\t\treturn this;\n\t}\n}\n\n/**\n * UIInput\n * @param {*} type\n * @param {*} value\n * @param {*} title\n */\nexport class UIInput extends UIElement {\n\n\tconstructor(type, value, title) {\n\n\t\tsuper(\"input\");\n\n\t\tthis.dom.type = type;\n\t\tthis.dom.onkeydown = (e) => {\n\n\t\t\te.stopPropagation();\n\t\t};\n\t\tthis.setValue(value);\n\t\tthis.setTitle(title);\n\t}\n\n\tgetName() {\n\n\t\treturn this.dom.name;\n\t}\n\n\tsetName(name) {\n\n\t\tthis.dom.name = name;\n\t\treturn this;\n\t}\n\n\tgetType() {\n\n\t\treturn this.dom.type;\n\t}\n\n\tsetType(type) {\n\n\t\tthis.dom.type = type;\n\t\treturn this;\n\t}\n\n\tgetValue() {\n\n\t\treturn this.dom.value;\n\t}\n\n\tsetValue(value) {\n\n\t\tif (this.dom.value !== value && value !== undefined)\n\t\t\tthis.dom.value = value;\n\t\treturn this;\n\t}\n}\n\n/**\n * UIColor\n */\nexport class UIColor extends UIElement {\n\n\tconstructor() {\n\n\t\tsuper(\"input\");\n\n\t\ttry {\n\n\t\t\tthis.dom.type = \"color\";\n\t\t\tthis.dom.value = \"#ffffff\";\n\n\t\t} catch (e) {\n\n\t\t\tconsole.exception(e);\n\t\t}\n\t}\n\n\tgetValue() {\n\n\t\treturn this.dom.value;\n\t}\n\n\tgetHexValue() {\n\n\t\treturn parseInt(this.dom.value.substr(1), 16);\n\t}\n\n\tsetValue(value) {\n\n\t\tthis.dom.value = value;\n\t\treturn this;\n\t}\n\n\tsetHexValue(hex) {\n\n\t\tthis.dom.value = \"#\" + (\"000000\" + hex.toString(16)).slice(-6);\n\t\treturn this;\n\t}\n}\n\n/**\n * UINumber\n * @param {number} value\n * @param {number} step\n * @param {number} min\n * @param {number} max\n * @param {number} precision\n */\nexport class UINumber extends UIElement {\n\n\tconstructor(value, step, min, max, precision) {\n\n\t\tsuper(\"input\");\n\n\t\tthis.dom.type = \"number\";\n\t\tthis.dom.step = step || 1;\n\t\tthis.dom.onkeydown = (e) => {\n\n\t\t\te.stopPropagation();\n\t\t};\n\t\tthis.value = value || 0;\n\t\tthis.min = min || -Infinity;\n\t\tthis.max = max || +Infinity;\n\t\tthis.precision = precision || 0;\n\t\tthis.setValue(value);\n\t\tthis.dom.onchange = (e) => {\n\n\t\t\tthis.setValue(this.value);\n\t\t};\n\t}\n\n\tgetName() {\n\n\t\treturn this.dom.name;\n\t}\n\n\tsetName(name) {\n\n\t\tthis.dom.name = name;\n\t\treturn this;\n\t}\n\n\tsetPrecision(precision) {\n\n\t\tthis.precision = precision;\n\t\tthis.setValue(this.value);\n\t\treturn this;\n\t}\n\n\tsetRange(min, max) {\n\n\t\tthis.min = min;\n\t\tthis.max = max;\n\t\tthis.dom.min = min;\n\t\tthis.dom.max = max;\n\t\treturn this;\n\t}\n\n\tsetStep(step) {\n\n\t\tthis.dom.step = step;\n\t\treturn this;\n\t}\n\n\tgetValue() {\n\n\t\treturn parseFloat(this.dom.value);\n\t}\n\n\tsetValue(value) {\n\n\t\tif (value !== undefined) {\n\t\t\tvalue = parseFloat(value);\n\n\t\t\tif (value < this.min)\n\t\t\t\tvalue = this.min;\n\t\t\tif (value > this.max)\n\t\t\t\tvalue = this.max;\n\n\t\t\tthis.value = value;\n\t\t\tthis.dom.value = value.toFixed(this.precision);\n\t\t}\n\t\treturn this;\n\t}\n}\n\n/**\n * UIBreak\n */\nexport class UIBreak extends UIElement {\n\n\tconstructor() {\n\n\t\tsuper(\"br\");\n\t}\n}\n\n/**\n * UIHorizontalRule\n */\nexport class UIHorizontalRule extends UIElement {\n\n\tconstructor() {\n\n\t\tsuper(\"hr\");\n\t}\n}\n\n/**\n * UIProgress\n * @param {*} value\n */\nexport class UIProgress extends UIElement {\n\n\tconstructor(value) {\n\n\t\tsuper(\"progress\");\n\n\t\tthis.dom.value = value;\n\t}\n\n\tsetValue(value) {\n\n\t\tthis.dom.value = value;\n\t\treturn this;\n\t}\n}\n\n/**\n * UITabbedPanel\n * @param {string} align (horizontal | vertical)\n */\nexport class UITabbedPanel extends UIDiv {\n\n\tconstructor(align) {\n\n\t\tsuper();\n\n\t\tthis.align = align || \"horizontal\";\n\t\tthis.tabs = [];\n\t\tthis.panels = [];\n\t\tthis.selector = new UISpan().setClass(\"tab-selector\");\n\t\tthis.menuDiv = new UIDiv().setClass(\"menu\");\n\t\tthis.tabsDiv = new UIDiv().setClass(\"tabs\");\n\t\tthis.tabsDiv.add(this.selector);\n\t\tthis.panelsDiv = new UIDiv().setClass(\"panels\");\n\t\tthis.selected = \"\";\n\t\tthis.add(this.menuDiv);\n\t\tthis.add(this.tabsDiv);\n\t\tthis.add(this.panelsDiv);\n\t}\n\n\taddMenu(items) {\n\t\tthis.menuDiv.add(items);\n\t}\n\n\taddTab(id, label, items) {\n\n\t\tconst tab = new UITab(label, this);\n\t\ttab.setId(id);\n\t\ttab.setClass(\"box\");\n\t\tthis.tabs.push(tab);\n\t\tthis.tabsDiv.add(tab);\n\n\t\tconst panel = new UIDiv();\n\t\tpanel.setId(id);\n\t\tpanel.add(items);\n\t\tthis.panels.push(panel);\n\t\tthis.panelsDiv.add(panel);\n\t\tthis.select(id);\n\t}\n\n\tselect(id) {\n\n\t\tfor (let tab of this.tabs) {\n\t\t\tif (tab.dom.id === id) {\n\t\t\t\ttab.addClass(\"selected\");\n\t\t\t\tthis.transformSelector(tab);\n\t\t\t} else if (tab.dom.id === this.selected) {\n\t\t\t\ttab.removeClass(\"selected\");\n\t\t\t}\n\t\t}\n\n\t\tfor (let panel of this.panels) {\n\t\t\tif (panel.dom.id === id) {\n\t\t\t\tpanel.dom.style.display = \"block\";\n\t\t\t} else if (panel.dom.id === this.selected) {\n\t\t\t\tpanel.dom.style.display = \"none\";\n\t\t\t}\n\t\t}\n\n\t\tthis.selected = id;\n\t\treturn this;\n\t}\n\n\tsetLabel(id, text) {\n\n\t\tfor (let tab of this.tabs) {\n\t\t\tif (tab.dom.id === id) {\n\t\t\t\ttab.setTitle(text);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\ttransformSelector(tab) {\n\n\t\tlet size;\n\t\tconst rect = tab.getBoundingClientRect();\n\t\tif (this.align === \"horizontal\") {\n\t\t\tsize = rect.width * this.tabs.indexOf(tab);\n\t\t\tthis.selector.dom.style.transform = `translateX(${size}px)`;\n\t\t} else {\n\t\t\tsize = rect.height * this.tabs.indexOf(tab);\n\t\t\tthis.selector.dom.style.transform = `translateY(${size}px)`;\n\t\t}\n\t}\n}\n\n/**\n * UITab\n * @param {string} text\n * @param {UITabbedPanel} parent\n */\nexport class UITab extends UIDiv {\n\n\tconstructor(text, parent) {\n\n\t\tsuper();\n\t\tthis.button = new UIInput(\"button\");\n\t\tthis.button.dom.title = text;\n\t\tthis.dom.onclick = (e) => {\n\n\t\t\tparent.select(this.dom.id);\n\t\t\te.preventDefault();\n\t\t};\n\t\tthis.add(this.button);\n\t}\n}\n\n/**\n * UIList\n * @param {UIItem} parent\n */\nexport class UIList extends UIElement {\n\n\tconstructor(parent) {\n\n\t\tsuper(\"ul\");\n\t\tthis.parent = parent && parent.parent; // LI->UL\n\t\tthis.expanded = false;\n\t}\n\n\texpand() {\n\n\t\tthis.expanded = true;\n\t\tthis.dom.style.display = \"block\";\n\t\tif (this.parent)\n\t\t\tthis.parent.expand();\n\t\treturn this;\n\t}\n\n\tcollaps() {\n\n\t\tthis.expanded = false;\n\t\tthis.dom.style.display = \"none\";\n\t\treturn this;\n\t}\n}\n\n/**\n * UIItem\n * @param {UIList} parent\n */\nexport class UIItem extends UIElement {\n\n\tconstructor(parent) {\n\n\t\tsuper(\"li\");\n\t\tthis.parent = parent; // UL\n\t\tthis.selected = false;\n\t}\n\n\tadd() {\n\t\tlet len = 0;\n\t\tconst box = new UIDiv().setId(\"item-box\");\n\t\tfor (let i = 0; i < arguments.length; i++) {\n\t\t\tconst argument = arguments[i];\n\t\t\tif (argument instanceof UIList) {\n\t\t\t\tsuper.add(argument);\n\t\t\t} else {\n\t\t\t\tbox.add(argument);\n\t\t\t\tlen++;\n\t\t\t}\n\t\t}\n\t\tif (len) super.add(box);\n\t\treturn this;\n\t}\n\n\tselect() {\n\n\t\tthis.selected = true;\n\t\tthis.setClass(\"selected\");\n\t\treturn this;\n\t}\n\n\tunselect() {\n\n\t\tthis.selected = false;\n\t\tthis.removeAttribute(\"class\");\n\t\treturn this;\n\t}\n}\n\n/**\n * UIBox\n * @param {UIElement} items\n */\nexport class UIBox extends UIElement {\n\n\tconstructor(items) {\n\n\t\tsuper(\"div\");\n\t\tthis.setClass(\"box\");\n\t\tthis.add(items);\n\t}\n}","import { UIDiv, UIInput } from \"./ui.js\";\n\nexport class Toolbar {\n\n\tconstructor(reader) {\n\n\t\tconst strings = reader.strings;\n\t\tconst settings = reader.settings;\n\n\t\tconst container = new UIDiv().setId(\"toolbar\");\n\t\tconst keys = [\n\t\t\t\"toolbar/sidebar\",\n\t\t\t\"toolbar/prev\",\n\t\t\t\"toolbar/next\",\n\t\t\t\"toolbar/openbook\",\n\t\t\t\"toolbar/openbook/error\",\n\t\t\t\"toolbar/bookmark\",\n\t\t\t\"toolbar/fullscreen\"\n\t\t];\n\t\tconst menu1 = new UIDiv().setClass(\"menu-1\");\n\t\tconst openerBox = new UIDiv().setId(\"btn-m\").setClass(\"box\");\n\t\tconst openerBtn = new UIInput(\"button\");\n\t\topenerBtn.dom.title = strings.get(keys[0]);\n\t\topenerBtn.dom.onclick = (e) => {\n\n\t\t\treader.emit(\"sidebaropener\", true);\n\t\t\topenerBtn.dom.blur();\n\t\t\te.preventDefault();\n\t\t};\n\t\topenerBox.add(openerBtn);\n\t\tmenu1.add(openerBox);\n\n\t\tlet prevBox, prevBtn;\n\t\tlet nextBox, nextBtn;\n\t\tif (settings.arrows === \"toolbar\") {\n\t\t\tprevBox = new UIDiv().setId(\"btn-p\").setClass(\"box\");\n\t\t\tprevBtn = new UIInput(\"button\");\n\t\t\tprevBtn.setTitle(strings.get(keys[1]));\n\t\t\tprevBtn.dom.onclick = (e) => {\n\n\t\t\t\treader.emit(\"prev\");\n\t\t\t\te.preventDefault();\n\t\t\t\tprevBtn.dom.blur();\n\t\t\t};\n\t\t\tprevBox.add(prevBtn);\n\t\t\tmenu1.add(prevBox);\n\n\t\t\tnextBox = new UIDiv().setId(\"btn-n\").setClass(\"box\");\n\t\t\tnextBtn = new UIInput(\"button\");\n\t\t\tnextBtn.dom.title = strings.get(keys[2]);\n\t\t\tnextBtn.dom.onclick = (e) => {\n\n\t\t\t\treader.emit(\"next\");\n\t\t\t\te.preventDefault();\n\t\t\t\tnextBtn.dom.blur();\n\t\t\t};\n\t\t\tnextBox.add(nextBtn);\n\t\t\tmenu1.add(nextBox);\n\t\t}\n\n\t\tconst menu2 = new UIDiv().setClass(\"menu-2\");\n\t\tlet openbookBtn;\n\t\tif (settings.openbook) {\n\t\t\tconst onload = (e) => {\n\n\t\t\t\treader.storage.clear();\n\t\t\t\treader.storage.set(e.target.result, () => {\n\t\t\t\t\treader.unload();\n\t\t\t\t\treader.init(e.target.result);\n\t\t\t\t\tconst url = new URL(window.location.origin);\n\t\t\t\t\twindow.history.pushState({}, \"\", url);\n\t\t\t\t});\n\t\t\t};\n\t\t\tconst onerror = (e) => {\n\t\t\t\tconsole.error(e);\n\t\t\t};\n\t\t\tconst openbookBox = new UIDiv().setId(\"btn-o\").setClass(\"box\");\n\t\t\topenbookBtn = new UIInput(\"file\");\n\t\t\topenbookBtn.dom.title = strings.get(keys[3]);\n\t\t\topenbookBtn.dom.accept = \"application/epub+zip\";\n\t\t\topenbookBtn.dom.onchange = (e) => {\n\n\t\t\t\tif (e.target.files.length === 0)\n\t\t\t\t\treturn;\n\n\t\t\t\tif (window.FileReader) {\n\n\t\t\t\t\tconst fr = new FileReader();\n\t\t\t\t\tfr.onload = onload;\n\t\t\t\t\tfr.readAsArrayBuffer(e.target.files[0]);\n\t\t\t\t\tfr.onerror = onerror;\n\t\t\t\t} else {\n\t\t\t\t\talert(strings.get(keys[4]));\n\t\t\t\t}\n\n\t\t\t};\n\t\t\topenbookBtn.dom.onclick = (e) => {\n\n\t\t\t\topenbookBtn.dom.blur();\n\t\t\t};\n\t\t\topenbookBox.add(openbookBtn);\n\t\t\tmenu2.add(openbookBox);\n\t\t}\n\n\t\tlet bookmarkBox, bookmarkBtn;\n\t\tif (settings.bookmarks) {\n\t\t\tbookmarkBox = new UIDiv().setId(\"btn-b\").setClass(\"box\");\n\t\t\tbookmarkBtn = new UIInput(\"button\");\n\t\t\tbookmarkBtn.setTitle(strings.get(keys[5]));\n\t\t\tbookmarkBtn.dom.onclick = (e) => {\n\n\t\t\t\tconst cfi = this.locationCfi;\n\t\t\t\tconst val = reader.isBookmarked(cfi) === -1;\n\t\t\t\treader.emit(\"bookmarked\", val);\n\t\t\t\te.preventDefault();\n\t\t\t\tbookmarkBtn.dom.blur();\n\t\t\t};\n\t\t\tbookmarkBox.add(bookmarkBtn);\n\t\t\tmenu2.add(bookmarkBox);\n\t\t}\n\n\t\tlet fullscreenBtn;\n\t\tif (settings.fullscreen) {\n\n\t\t\tconst fullscreenBox = new UIDiv().setId(\"btn-f\").setClass(\"box\");\n\t\t\tfullscreenBtn = new UIInput(\"button\");\n\t\t\tfullscreenBtn.setTitle(strings.get(keys[6]));\n\t\t\tfullscreenBtn.dom.onclick = (e) => {\n\n\t\t\t\tthis.toggleFullScreen();\n\t\t\t\te.preventDefault();\n\t\t\t};\n\n\t\t\tdocument.onkeydown = (e) => {\n\n\t\t\t\tif (e.key === \"F11\") {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.toggleFullScreen();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tdocument.onfullscreenchange = (e) => {\n\n\t\t\t\tconst w = window.screen.width === e.target.clientWidth;\n\t\t\t\tconst h = window.screen.height === e.target.clientHeight;\n\n\t\t\t\tif (w && h) {\n\t\t\t\t\tfullscreenBox.addClass(\"resize-small\");\n\t\t\t\t} else {\n\t\t\t\t\tfullscreenBox.removeClass(\"resize-small\");\n\t\t\t\t}\n\t\t\t};\n\t\t\tfullscreenBox.add(fullscreenBtn);\n\t\t\tmenu2.add(fullscreenBox);\n\t\t}\n\n\t\tcontainer.add([menu1, menu2]);\n\t\tdocument.body.appendChild(container.dom);\n\n\t\t//-- events --//\n\n\t\treader.on(\"relocated\", (location) => {\n\n\t\t\tif (settings.bookmarks) {\n\t\t\t\tconst cfi = location.start.cfi;\n\t\t\t\tconst val = reader.isBookmarked(cfi) === -1;\n\t\t\t\tif (val) {\n\t\t\t\t\tbookmarkBox.removeClass(\"bookmarked\");\n\t\t\t\t} else {\n\t\t\t\t\tbookmarkBox.addClass(\"bookmarked\");\n\t\t\t\t}\n\t\t\t\tthis.locationCfi = cfi; // save location cfi\n\t\t\t}\n\t\t\tif (settings.arrows === \"toolbar\") {\n\t\t\t\tprevBox.dom.style.display = location.atStart ? \"none\" : \"block\";\n\t\t\t\tnextBox.dom.style.display = location.atEnd ? \"none\" : \"block\";\n\t\t\t}\n\t\t});\n\n\t\treader.on(\"bookmarked\", (boolean) => {\n\n\t\t\tif (boolean) {\n\t\t\t\tbookmarkBox.addClass(\"bookmarked\");\n\t\t\t} else {\n\t\t\t\tbookmarkBox.removeClass(\"bookmarked\");\n\t\t\t}\n\t\t});\n\n\t\treader.on(\"languagechanged\", (value) => {\n\n\t\t\topenerBtn.setTitle(strings.get(keys[0]));\n\n\t\t\tif (settings.arrows === \"toolbar\") {\n\t\t\t\tprevBtn.setTitle(strings.get(keys[1]));\n\t\t\t\tnextBtn.setTitle(strings.get(keys[2]));\n\t\t\t}\n\t\t\tif (settings.openbook) {\n\t\t\t\topenbookBtn.setTitle(strings.get(keys[3]));\n\t\t\t}\n\t\t\tif (settings.bookmarks) {\n\t\t\t\tbookmarkBtn.setTitle(strings.get(keys[5]));\n\t\t\t}\n\t\t\tif (settings.fullscreen) {\n\t\t\t\tfullscreenBtn.setTitle(strings.get(keys[6]));\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggleFullScreen() {\n\n\t\tdocument.activeElement.blur();\n\n\t\tif (document.fullscreenElement === null) {\n\t\t\tdocument.documentElement.requestFullscreen();\n\t\t} else if (document.exitFullscreen) {\n\t\t\tdocument.exitFullscreen();\n\t\t}\n\t}\n}","import { UIDiv, UISpan } from \"./ui.js\";\n\nexport class Content {\n\n\tconstructor(reader) {\n\n\t\tconst settings = reader.settings;\n\t\tconst container = new UIDiv().setId(\"content\");\n\n\t\tlet prev;\n\t\tif (settings.arrows === \"content\") {\n\n\t\t\tprev = new UIDiv().setId(\"prev\").setClass(\"arrow\");\n\t\t\tprev.dom.onclick = (e) => {\n\n\t\t\t\treader.emit(\"prev\");\n\t\t\t\te.preventDefault();\n\t\t\t};\n\t\t\tprev.add(new UISpan(\"<\"));\n\t\t\tcontainer.add(prev);\n\t\t}\n\n\t\tconst viewer = new UIDiv().setId(\"viewer\");\n\t\tcontainer.add(viewer);\n\n\t\tlet next;\n\t\tif (settings.arrows === \"content\") {\n\t\t\tnext = new UIDiv().setId(\"next\").setClass(\"arrow\");\n\t\t\tnext.dom.onclick = (e) => {\n\n\t\t\t\treader.emit(\"next\");\n\t\t\t\te.preventDefault();\n\t\t\t};\n\t\t\tnext.add(new UISpan(\">\"));\n\t\t\tcontainer.add(next);\n\t\t}\n\n\t\tconst loader = new UIDiv().setId(\"loader\");\n\t\tconst divider = new UIDiv().setId(\"divider\");\n\t\tconst overlay = new UIDiv().setId(\"overlay\");\n\t\toverlay.dom.onclick = (e) => {\n\t\t\treader.emit(\"sidebaropener\", false);\n\t\t\te.preventDefault();\n\t\t};\n\n\t\tcontainer.add([loader, divider, overlay]);\n\t\tdocument.body.appendChild(container.dom);\n\n\t\t//-- events --//\n\n\t\treader.on(\"bookready\", (cfg) => {\n\n\t\t\tviewer.setClass(cfg.flow);\n\t\t\tloader.dom.style.display = \"block\";\n\t\t});\n\n\t\treader.on(\"bookloaded\", () => {\n\n\t\t\tloader.dom.style.display = \"none\";\n\t\t});\n\n\t\treader.on(\"layout\", (props) => {\n\n\t\t\tif (props.spread && props.width > props.spreadWidth) {\n\t\t\t\tdivider.dom.style.display = \"block\";\n\t\t\t} else {\n\t\t\t\tdivider.dom.style.display = \"none\";\n\t\t\t}\n\t\t});\n\n\t\treader.on(\"flowchanged\", (value) => {\n\t\t\t\n\t\t\tviewer.setClass(value);\n\t\t});\n\n\t\treader.on(\"relocated\", (location) => {\n\n\t\t\tif (settings.arrows === \"content\") {\n\t\t\t\tif (location.atStart) {\n\t\t\t\t\tprev.addClass(\"disabled\");\n\t\t\t\t} else {\n\t\t\t\t\tprev.removeClass(\"disabled\");\n\t\t\t\t}\n\t\t\t\tif (location.atEnd) {\n\t\t\t\t\tnext.addClass(\"disabled\");\n\t\t\t\t} else {\n\t\t\t\t\tnext.removeClass(\"disabled\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treader.on(\"prev\", () => {\n\n\t\t\tif (settings.arrows === \"content\") {\n\t\t\t\tprev.addClass(\"active\");\n\t\t\t\tsetTimeout(() => { prev.removeClass(\"active\"); }, 100);\n\t\t\t}\n\t\t});\n\n\t\treader.on(\"next\", () => {\n\n\t\t\tif (settings.arrows === \"content\") {\n\t\t\t\tnext.addClass(\"active\");\n\t\t\t\tsetTimeout(() => { next.removeClass(\"active\"); }, 100);\n\t\t\t}\n\t\t});\n\n\t\treader.on(\"sidebaropener\", (value) => {\n\n\t\t\toverlay.dom.style.display = value ? \"block\" : \"none\";\n\t\t});\n\n\t\treader.on(\"viewercleanup\", () => {\n\n\t\t\tviewer.clear();\n\t\t});\n\t}\n}","import { UIPanel, UIDiv, UIItem, UIList, UILink, UISpan, UIText, UIBox } from \"../ui.js\";\n\nexport class TocPanel extends UIPanel {\n\n\tconstructor(reader) {\n\n\t\tsuper();\n\t\tconst container = new UIDiv().setClass(\"list-container\");\n\t\tconst strings = reader.strings;\n\t\tconst keys = [\n\t\t\t\"sidebar/contents\"\n\t\t];\n\t\tconst label = new UIText(strings.get(keys[0])).setClass(\"label\");\n\t\tthis.reader = reader;\n\t\tthis.selector = undefined; // save reference to selected tree item\n\t\tthis.setId(\"contents\");\n\t\tthis.add(new UIBox(label).addClass(\"header\"));\n\n\t\t//-- events --//\n\n\t\treader.on(\"navigation\", (toc) => {\n\n\t\t\tcontainer.clear();\n\t\t\tcontainer.add(this.generateToc(toc));\n\t\t\tthis.add(container);\n\t\t});\n\n\t\treader.on(\"languagechanged\", (value) => {\n\n\t\t\tlabel.setValue(strings.get(keys[0]));\n\t\t});\n\t}\n\n\tgenerateToc(toc, parent) {\n\n\t\tconst list = new UIList(parent);\n\n\t\ttoc.forEach((chapter) => {\n\n\t\t\tconst link = new UILink(chapter.href, chapter.label);\n\t\t\tconst item = new UIItem(list).setId(chapter.id);\n\t\t\tconst ibtn = new UISpan();\n\n\t\t\tlink.dom.onclick = (e) => {\n\n\t\t\t\tif (this.selector && this.selector !== item)\n\t\t\t\t\tthis.selector.unselect();\n\n\t\t\t\titem.select();\n\t\t\t\tthis.selector = item;\n\t\t\t\tthis.reader.settings.sectionId = chapter.id;\n\t\t\t\tthis.reader.rendition.display(chapter.href);\n\t\t\t\te.preventDefault();\n\t\t\t};\n\t\t\titem.add([ibtn, link]);\n\t\t\tthis.reader.navItems[chapter.href] = {\n\t\t\t\tid: chapter.id,\n\t\t\t\tlabel: chapter.label\n\t\t\t};\n\n\t\t\tif (this.reader.settings.sectionId === chapter.id) {\n\t\t\t\tlist.expand();\n\t\t\t\titem.select();\n\t\t\t\tthis.selector = item;\n\t\t\t}\n\n\t\t\tif (chapter.subitems && chapter.subitems.length > 0) {\n\n\t\t\t\tconst subItems = this.generateToc(chapter.subitems, item);\n\t\t\t\tibtn.setClass(\"toggle-collapsed\");\n\t\t\t\tibtn.dom.onclick = () => {\n\n\t\t\t\t\tif (subItems.expanded) {\n\t\t\t\t\t\tsubItems.collaps();\n\t\t\t\t\t\tibtn.setClass(\"toggle-collapsed\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsubItems.expand();\n\t\t\t\t\t\tibtn.setClass(\"toggle-expanded\");\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\t\t\t\titem.add(subItems);\n\t\t\t}\n\n\t\t\tlist.add(item);\n\t\t});\n\n\t\treturn list;\n\t}\n}","import { UIPanel, UIDiv, UIRow, UIInput, UILink, UIList, UIItem, UIText, UIBox, UISpan } from \"../ui.js\";\n\nexport class BookmarksPanel extends UIPanel {\n\n\tconstructor(reader) {\n\n\t\tsuper();\n\t\tconst container = new UIDiv().setClass(\"list-container\");\n\t\tconst strings = reader.strings;\n\t\tconst keys = [\n\t\t\t\"sidebar/bookmarks\",\n\t\t\t\"sidebar/bookmarks/clear\"\n\t\t];\n\t\tconst headerLabel = new UIText(strings.get(keys[0])).setClass(\"label\");\n\t\tconst clearBtn = new UIInput(\"button\", strings.get(keys[1]));\n\t\tclearBtn.dom.onclick = (e) => {\n\n\t\t\tthis.clearBookmarks();\n\t\t\treader.emit(\"bookmarked\", false);\n\t\t\te.preventDefault();\n\t\t};\n\t\tthis.add(new UIBox([headerLabel, clearBtn]).addClass(\"header\"));\n\t\tthis.selector = undefined;\n\t\tthis.bookmarks = new UIList();\n\t\tcontainer.add(this.bookmarks);\n\t\tthis.setId(\"bookmarks\");\n\t\tthis.add(container);\n\t\tthis.reader = reader;\n\n\t\tconst update = () => {\n\n\t\t\tclearBtn.dom.disabled = reader.settings.bookmarks.length === 0;\n\t\t};\n\n\t\t//-- events --//\n\n\t\treader.on(\"displayed\", (renderer, cfg) => {\n\n\t\t\tcfg.bookmarks.forEach((cfi) => {\n\n\t\t\t\tthis.setBookmark(cfi);\n\t\t\t});\n\t\t\tupdate();\n\t\t});\n\n\t\treader.on(\"relocated\", (location) => {\n\n\t\t\tthis.locationCfi = location.start.cfi; // save location cfi\n\t\t});\n\n\t\treader.on(\"bookmarked\", (boolean, cfi) => {\n\n\t\t\tif (boolean) {\n\t\t\t\tthis.appendBookmark();\n\t\t\t} else {\n\t\t\t\tthis.removeBookmark(cfi);\n\t\t\t}\n\t\t\tupdate();\n\t\t});\n\n\t\treader.on(\"languagechanged\", (value) => {\n\n\t\t\theaderLabel.setValue(strings.get(keys[0]));\n\t\t\tclearBtn.setValue(strings.get(keys[1]));\n\t\t});\n\t}\n\n\tappendBookmark() {\n\n\t\tconst cfi = this.locationCfi;\n\t\tif (this.reader.isBookmarked(cfi) > -1) {\n\t\t\treturn;\n\t\t}\n\t\tthis.setBookmark(cfi);\n\t\tthis.reader.settings.bookmarks.push(cfi);\n\t}\n\n\tremoveBookmark(cfi) {\n\n\t\tconst _cfi = cfi || this.locationCfi;\n\t\tconst index = this.reader.isBookmarked(_cfi);\n\t\tif (index === -1) {\n\t\t\treturn;\n\t\t}\n\t\tthis.bookmarks.remove(index);\n\t\tthis.reader.settings.bookmarks.splice(index, 1);\n\t}\n\n\tclearBookmarks() {\n\n\t\tthis.bookmarks.clear();\n\t\tthis.reader.settings.bookmarks = [];\n\t}\n\n\tsetBookmark(cfi) {\n\n\t\tconst link = new UILink();\n\t\tconst item = new UIItem();\n\t\tconst btnr = new UISpan().setClass(\"btn-remove\");\n\t\tconst navItem = this.reader.navItemFromCfi(cfi);\n\t\tlet idref;\n\t\tlet label;\n\n\t\tif (navItem === undefined) {\n\t\t\tconst spineItem = this.reader.book.spine.get(cfi);\n\t\t\tidref = spineItem.idref;\n\t\t\tlabel = spineItem.idref\n\t\t} else {\n\t\t\tidref = navItem.id;\n\t\t\tlabel = navItem.label;\n\t\t}\n\n\t\tlink.setHref(\"#\" + cfi);\n\t\tlink.dom.onclick = (e) => {\n\n\t\t\tif (this.selector && this.selector !== item) {\n\t\t\t\tthis.selector.unselect();\n\t\t\t}\n\t\t\titem.select();\n\t\t\tthis.selector = item;\n\t\t\tthis.reader.rendition.display(cfi);\n\t\t\te.preventDefault();\n\t\t};\n\t\tlink.setTextContent(label);\n\n\t\tbtnr.dom.onclick = (e) => {\n\n\t\t\tthis.reader.emit(\"bookmarked\", false, cfi);\n\t\t\te.preventDefault();\n\t\t};\n\n\t\titem.add([link, btnr]);\n\t\titem.setId(idref);\n\t\tthis.bookmarks.add(item);\n\t}\n}","import { UIPanel, UIDiv, UITextArea, UIInput, UILink, UIList, UIItem, UISpan, UIText, UIBox } from \"../ui.js\";\n\nexport class AnnotationsPanel extends UIPanel {\n\n\tconstructor(reader) {\n\n\t\tsuper();\n\t\tconst container = new UIDiv().setClass(\"list-container\");\n\t\tconst strings = reader.strings;\n\t\tconst keys = [\n\t\t\t\"sidebar/annotations\",\n\t\t\t\"sidebar/annotations/clear\"\n\t\t];\n\t\tconst headerLabel = new UIText(strings.get(keys[0])).setClass(\"label\");\n\t\tconst clearBtn = new UIInput(\"button\", strings.get(keys[1]));\n\t\tclearBtn.dom.onclick = (e) => {\n\n\t\t\tthis.clearNotes();\n\t\t\te.preventDefault();\n\t\t};\n\t\tthis.add(new UIBox([headerLabel, clearBtn]).addClass(\"header\"));\n\t\tthis.selector = undefined;\n\t\tthis.notes = new UIList();\n\t\tcontainer.add(this.notes);\n\t\tthis.setId(\"annotations\");\n\t\tthis.add(container);\n\t\tthis.reader = reader;\n\t\tthis.update = () => {\n\n\t\t\tclearBtn.dom.disabled = reader.settings.annotations.length === 0;\n\t\t};\n\n\t\t//-- events --//\n\n\t\treader.on(\"bookready\", (cfg) => {\n\n\t\t\tcfg.annotations.forEach((note) => {\n\n\t\t\t\tthis.set(note);\n\t\t\t});\n\t\t\tthis.update();\n\t\t});\n\n\t\treader.on(\"noteadded\", (note) => {\n\n\t\t\tthis.set(note);\n\t\t\tthis.update();\n\t\t});\n\n\t\treader.on(\"languagechanged\", (value) => {\n\n\t\t\theaderLabel.setValue(strings.get(keys[0]));\n\t\t\tclearBtn.setValue(strings.get(keys[1]));\n\t\t});\n\t}\n\n\tset(note) {\n\n\t\tconst link = new UILink(\"#\" + note.cfi, note.text);\n\t\tconst item = new UIItem().setId(\"note-\" + note.uuid);\n\t\tconst btnr = new UISpan().setClass(\"btn-remove\");\n\t\tconst call = () => { };\n\n\t\tlink.dom.onclick = (e) => {\n\n\t\t\tif (this.selector && this.selector !== item) {\n\t\t\t\tthis.selector.unselect();\n\t\t\t}\n\t\t\titem.select();\n\t\t\tthis.selector = item;\n\t\t\tthis.reader.rendition.display(note.cfi);\n\t\t\te.preventDefault();\n\t\t};\n\n\t\tbtnr.dom.onclick = (e) => {\n\n\t\t\tthis.removeNote(note);\n\t\t\te.preventDefault();\n\t\t};\n\n\t\titem.add([link, btnr]);\n\t\tthis.notes.add(item);\n\t\tthis.reader.rendition.annotations.add(\n\t\t\t\"highlight\", note.cfi, {}, call, \"note-highlight\", {});\n\t\tthis.update();\n\t}\n\n\tremoveNote(note) {\n\n\t\tconst index = this.reader.settings.annotations.indexOf(note);\n\t\tif (index === -1)\n\t\t\treturn;\n\n\t\tthis.notes.remove(index);\n\t\tthis.reader.settings.annotations.splice(index, 1);\n\t\tthis.reader.rendition.annotations.remove(note.cfi, \"highlight\");\n\t\tthis.update();\n\t}\n\n\tclearNotes() {\n\n\t\tthis.reader.settings.annotations.forEach(note => {\n\t\t\tthis.reader.rendition.annotations.remove(note.cfi, \"highlight\");\n\t\t});\n\t\tthis.notes.clear();\n\t\tthis.reader.settings.annotations = [];\n\t\tthis.update();\n\t}\n}","import { UIPanel, UIDiv, UIInput, UILink, UIList, UIItem, UIBox } from \"../ui.js\";\n\nexport class SearchPanel extends UIPanel {\n\n\tconstructor(reader) {\n\n\t\tsuper();\n\t\tconst container = new UIDiv().setClass(\"list-container\");\n\t\tconst strings = reader.strings;\n\n\t\tlet searchQuery = undefined;\n\t\tconst search = new UIInput(\"search\").setId(\"nav-q\");\n\t\tsearch.dom.placeholder = strings.get(\"sidebar/search/placeholder\");\n\t\tsearch.dom.onsearch = () => {\n\n\t\t\tconst value = search.getValue();\n\n\t\t\tif (value.length === 0) {\n\t\t\t\tthis.items.clear();\n\t\t\t} else if (searchQuery !== value) {\n\t\t\t\tthis.items.clear();\n\t\t\t\tthis.doSearch(value).then(results => {\n\n\t\t\t\t\tresults.forEach(data => {\n\t\t\t\t\t\tthis.set(data);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tsearchQuery = value;\n\t\t};\n\n\t\tthis.setId(\"search\");\n\t\tthis.items = new UIList();\n\t\tcontainer.add(this.items);\n\t\tthis.add([new UIBox(search), container]);\n\t\tthis.reader = reader;\n\t\tthis.selector = undefined;\n\t\t//\n\t\t// improvement of the highlighting of keywords is required...\n\t\t//\n\t}\n\n\t/**\n\t * Searching the entire book\n\t * @param {*} q Query keyword\n\t * @returns The search result array.\n\t */\n\tasync doSearch(q) {\n\n\t\tconst book = this.reader.book;\n\t\tconst results = await Promise.all(\n\t\t\tbook.spine.spineItems.map(item => item.load(book.load.bind(book))\n\t\t\t\t.then(item.find.bind(item, q)).finally(item.unload.bind(item))));\n\t\treturn await Promise.resolve([].concat.apply([], results));\n\t}\n\n\tset(data) {\n\n\t\tconst link = new UILink(\"#\" + data.cfi, data.excerpt);\n\t\tconst item = new UIItem();\n\t\tlink.dom.onclick = () => {\n\n\t\t\tif (this.selector && this.selector !== item)\n\t\t\t\tthis.selector.unselect();\n\t\t\t\n\t\t\titem.select();\n\t\t\tthis.selector = item;\n\t\t\tthis.reader.rendition.display(data.cfi);\n\t\t\treturn false;\n\t\t};\n\t\titem.add(link);\n\t\tthis.items.add(item);\n\t}\n}","import { UIPanel, UIRow, UISelect, UIInput, UILabel, UINumber, UIText, UIBox, UIDiv } from \"../ui.js\";\n\nexport class SettingsPanel extends UIPanel {\n\n\tconstructor(reader) {\n\n\t\tsuper();\n\t\tsuper.setId(\"settings\");\n\n\t\tconst strings = reader.strings;\n\t\tconst keys = [\n\t\t\t\"sidebar/settings\",\n\t\t\t\"sidebar/settings/language\",\n\t\t\t\"sidebar/settings/fontsize\",\n\t\t\t\"sidebar/settings/flow\",\n\t\t\t\"sidebar/settings/spread\",\n\t\t\t\"sidebar/settings/spread/minwidth\",\n\t\t\t\"sidebar/settings/theme\",\n\t\t];\n\t\tconst headerLabel = new UIText(strings.get(keys[0])).setClass(\"label\");\n\t\tthis.add(new UIBox(headerLabel).addClass(\"header\"));\n\n\t\tconst languageLabel = new UILabel(strings.get(keys[1]), \"language-ui\");\n\t\tconst languageRow = new UIRow();\n\t\tconst language = new UISelect().setOptions({\n\t\t\tzh: \"中文\",\n\t\t\ten: \"English\"\n\t\t});\n\t\tlanguage.dom.onchange = (e) => {\n\n\t\t\treader.emit(\"languagechanged\", e.target.value);\n\t\t};\n\t\tlanguage.setId(\"language-ui\");\n\t\tlanguageRow.add(languageLabel);\n\t\tlanguageRow.add(language);\n\n\t\tconst themeLabel = new UILabel(strings.get(\"sidebar/settings/theme\"), \"theme\");\n\t\tconst themeRow = new UIRow();\n\t\tconst theme = new UISelect().setOptions({\n\t\t\tlight: strings.get(\"sidebar/settings/theme/items\")[0],\n\t\t\tdark: strings.get(\"sidebar/settings/theme/items\")[1],\n\t\t\teyecare: strings.get(\"sidebar/settings/theme/items\")[2]\n\t\t});\n\t\ttheme.dom.onchange = (e) => {\n\t\t\treader.emit(\"themechanged\", e.target.value);\n\t\t};\n\t\ttheme.setId(\"theme\");\n\t\tthemeRow.add(themeLabel);\n\t\tthemeRow.add(theme);\n\n\t\tconst fontLabel = new UILabel(strings.get(\"sidebar/settings/font\"), \"font\");\n\t\tconst fontRow = new UIRow();\n\t\tconst font = new UISelect().setOptions({\n\t\t\t\"default\": strings.get(\"sidebar/settings/font/default\"),\n\t\t\t\"FZSongKeBenXiuKaiS-R-GB\": \"方正宋刻本秀楷\",\n\t\t\t\"Huiwen-HKHei\": \"汇文港黑\",\n\t\t\t\"Huiwen-Fangsong\": \"汇文仿宋体\",\n\t\t\t\"Bookerly\": \"Bookerly\",\n\t\t});\n\t\tfont.dom.onchange = (e) => {\n\t\t\tconsole.log(`Selected font: ${e.target.value}`);\n\t\t\treader.emit(\"styleschanged\", {\n\t\t\t\tfont: e.target.value\n\t\t\t});\n\t\t};\n\t\tfont.setId(\"font\");\n\t\tfontRow.add(fontLabel);\n\t\tfontRow.add(font);\n\n\t\tconst fontSizeLabel = new UILabel(strings.get(keys[2]), \"fontsize\");\n\t\tconst fontSizeRow = new UIRow();\n\t\tconst fontSize = new UINumber(100, 1);\n\t\tfontSize.dom.onchange = (e) => {\n\n\t\t\treader.emit(\"styleschanged\", {\n\t\t\t\tfontSize: parseInt(e.target.value)\n\t\t\t});\n\t\t};\n\t\tfontSize.setId(\"fontsize\")\n\t\tfontSizeRow.add(fontSizeLabel);\n\t\tfontSizeRow.add(fontSize);\n\n\t\t//-- flow configure --//\n\n\t\tconst flowLabel = new UILabel(strings.get(keys[3]), \"flow\");\n\t\tconst flowRow = new UIRow();\n\n\t\tconst flowModeStr = strings.get(\"sidebar/settings/pagination\");\n\t\tconst flow = new UISelect().setOptions({\n\t\t\tpaginated: flowModeStr[0],\n\t\t\tscrolled: flowModeStr[1]\n\t\t});\n\t\tflow.dom.onchange = (e) => {\n\n\t\t\treader.emit(\"flowchanged\", e.target.value);\n\n\t\t\tif (e.target.value === \"scrolled\") {\n\t\t\t\treader.emit(\"spreadchanged\", {\n\t\t\t\t\tmod: \"none\",\n\t\t\t\t\tmin: undefined\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treader.emit(\"spreadchanged\", {\n\t\t\t\t\tmod: undefined,\n\t\t\t\t\tmin: undefined\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tflow.setId(\"flow\");\n\t\tflowRow.add(flowLabel);\n\t\tflowRow.add(flow);\n\n\t\t//-- spdead configure --//\n\n\t\tconst minSpreadWidth = new UINumber(800, 1);\n\t\tconst spreadLabel = new UILabel(strings.get(keys[4]), \"spread\");\n\t\tconst spreadRow = new UIRow();\n\t\tconst spreadValues = strings.get(\"sidebar/settings/spread/items\");\n\t\tconst spread = new UISelect().setOptions({\n\t\t\tnone: spreadValues[0],\n\t\t\tauto: spreadValues[1]\n\t\t});\n\t\tspread.dom.onchange = (e) => {\n\n\t\t\treader.emit(\"spreadchanged\", {\n\t\t\t\tmod: e.target.value,\n\t\t\t\tmin: undefined\n\t\t\t});\n\t\t\tminSpreadWidth.dom.disabled = e.target.value === \"none\";\n\t\t};\n\t\tspread.setId(\"spread\");\n\n\t\tspreadRow.add(spreadLabel);\n\t\tspreadRow.add(spread);\n\n\t\tconst minSpreadWidthLabel = new UILabel(strings.get(keys[5]), \"min-spread-width\");\n\t\tconst minSpreadWidthRow = new UIRow();\n\t\tminSpreadWidth.dom.onchange = (e) => {\n\n\t\t\treader.emit(\"spreadchanged\", {\n\t\t\t\tmod: undefined,\n\t\t\t\tmin: parseInt(e.target.value)\n\t\t\t});\n\t\t};\n\t\tminSpreadWidth.setId(\"min-spread-width\");\n\t\tminSpreadWidthRow.add(minSpreadWidthLabel);\n\t\tminSpreadWidthRow.add(minSpreadWidth);\n\n\t\t//-- pagination --//\n\n\t\tconst paginationStr = strings.get(\"sidebar/settings/pagination\");\n\t\tconst paginationRow = new UIRow();\n\t\tconst pagination = new UIInput(\"checkbox\", false, paginationStr[1]);\n\t\tpagination.setId(\"pagination\");\n\t\tpagination.dom.onclick = (e) => {\n\n\t\t\t// not implemented\n\t\t};\n\n\t\tpaginationRow.add(new UILabel(paginationStr[0], \"pagination\"));\n\t\tpaginationRow.add(pagination);\n\n\t\tthis.add(new UIBox([\n\t\t\tlanguageRow,\n\t\t\tthemeRow,\n\t\t\tfontRow,\n\t\t\tfontSizeRow,\n\t\t\tflowRow,\n\t\t\tspreadRow,\n\t\t\tminSpreadWidthRow,\n\t\t\t//paginationRow\n\t\t]));\n\n\t\t//-- events --//\n\n\t\treader.on(\"bookready\", (cfg) => {\n\n\t\t\tlanguage.setValue(cfg.language);\n\t\t\ttheme.setValue(cfg.theme);\n\t\t\tfont.setValue(cfg.styles.font);\n\t\t\tif (!cfg.styles.font) {\n\t\t\t\tfont.setValue(\"default\");\n\t\t\t}\n\t\t\tfontSize.setValue(cfg.styles.fontSize);\n\t\t\tflow.setValue(cfg.flow);\n\t\t\tspread.setValue(cfg.spread.mod);\n\t\t\tminSpreadWidth.setValue(cfg.spread.min);\n\t\t\tminSpreadWidth.dom.disabled = cfg.spread.mod === \"none\";\n\t\t\treader.emit(\"styleschanged\", {\n\t\t\t\tfont: cfg.styles.font,\n\t\t\t\tfontSize: cfg.styles.fontSize\n\t\t\t});\n\t\t});\n\n\t\treader.on(\"layout\", (props) => {\n\n\t\t\tif (props.flow === \"scrolled\") {\n\t\t\t\tspread.setValue(\"none\");\n\t\t\t\tspread.dom.disabled = true;\n\t\t\t\tminSpreadWidth.dom.disabled = true;\n\t\t\t} else {\n\t\t\t\tspread.dom.disabled = false;\n\t\t\t}\n\t\t});\n\n\t\treader.on(\"languagechanged\", (value) => {\n\n\t\t\theaderLabel.setTextContent(strings.get(keys[0]));\n\t\t\tlanguageLabel.setTextContent(strings.get(keys[1]));\n\t\t\tfontLabel.setTextContent(strings.get(\"sidebar/settings/font\"));\n\t\t\tfontSizeLabel.setTextContent(strings.get(keys[2]));\n\t\t\tflowLabel.setTextContent(strings.get(keys[3]));\n\t\t\tconst flowModeStr = strings.get(\"sidebar/settings/pagination\");\n\t\t\tflow.setOptions({\n\t\t\t\tpaginated: flowModeStr[0],\n\t\t\t\tscrolled: flowModeStr[1]\n\t\t\t});\n\t\t\tspreadLabel.setTextContent(strings.get(keys[4]));\n\t\t\tconst spreadValues = strings.get(\"sidebar/settings/spread/items\");\n\t\t\tspread.setOptions({\n\t\t\t\tnone: spreadValues[0],\n\t\t\t\tauto: spreadValues[1]\n\t\t\t});\n\t\t\tminSpreadWidthLabel.setTextContent(strings.get(keys[5]));\n\t\t\tthemeLabel.setTextContent(strings.get(\"sidebar/settings/theme\"));\n\t\t\ttheme.setOptions({\n\t\t\t\tlight: strings.get(\"sidebar/settings/theme/items\")[0],\n\t\t\t\tdark: strings.get(\"sidebar/settings/theme/items\")[1],\n\t\t\t\teyecare: strings.get(\"sidebar/settings/theme/items\")[2]\n\t\t\t});\n\t\t});\n\t}\n}","import { UIBox, UIDiv, UIItem, UIList, UIPanel, UIText } from \"../ui.js\";\n\nexport class MetadataPanel extends UIPanel {\n\n\tconstructor(reader) {\n\n\t\tsuper();\n\t\tconst container = new UIDiv().setClass(\"list-container\");\n\t\tconst strings = reader.strings;\n\t\tconst labels = {};\n\t\tconst key = \"sidebar/metadata\";\n\t\tconst label = new UIText(strings.get(key)).setClass(\"label\");\n\t\tthis.add(new UIBox(label).addClass(\"header\"));\n\t\tlabels[key] = label;\n\n\t\tthis.items = new UIList();\n\t\tthis.setId(\"metadata\");\n\t\tthis.add(container);\n\n\t\tconst init = (prop, meta) => {\n\t\t\tif (meta[prop] === undefined ||\n\t\t\t\tmeta[prop] === null || (typeof meta[prop] === \"string\" && meta[prop].length === 0)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst item = new UIItem();\n\t\t\tconst label = new UIText().setClass(\"label\");\n\t\t\tconst value = new UIText().setClass(\"value\");\n\t\t\tlabel.setValue(strings.get(key + \"/\" + prop).toUpperCase());\n\t\t\tif (prop === \"description\") {\n\t\t\t\tvalue.dom.innerHTML = meta[prop];\n\t\t\t} else {\n\t\t\t\tvalue.setValue(meta[prop]);\n\t\t\t}\n\t\t\tlabels[key + \"/\" + prop] = label;\n\t\t\titem.add([label, value]);\n\t\t\tthis.items.add(item);\n\t\t}\n\n\t\t//-- events --//\n\n\t\treader.on(\"metadata\", (meta) => {\n\n\t\t\tthis.items.clear();\n\t\t\tcontainer.clear();\n\t\t\tcontainer.add(this.items);\n\t\t\tdocument.title = meta.title;\n\t\t\tfor (const prop in meta) {\n\t\t\t\tinit(prop, meta);\n\t\t\t}\n\t\t});\n\n\t\treader.on(\"languagechanged\", (value) => {\n\n\t\t\tfor (const prop in labels) {\n\t\t\t\tlet text;\n\t\t\t\tif (prop === key) {\n\t\t\t\t\ttext = strings.get(prop);\n\t\t\t\t} else {\n\t\t\t\t\ttext = strings.get(prop).toUpperCase();\n\t\t\t\t}\n\t\t\t\tlabels[prop].setValue(text);\n\t\t\t}\n\t\t});\n\t}\n}","import { UITabbedPanel, UIInput, UIDiv } from \"./ui.js\";\nimport { TocPanel } from \"./sidebar/toc.js\";\nimport { BookmarksPanel } from \"./sidebar/bookmarks.js\";\nimport { AnnotationsPanel } from \"./sidebar/annotations.js\";\nimport { SearchPanel } from \"./sidebar/search.js\";\nimport { SettingsPanel } from \"./sidebar/settings.js\";\nimport { MetadataPanel } from \"./sidebar/metadata.js\";\n\nexport class Sidebar {\n\n\tconstructor(reader) {\n\n\t\tconst strings = reader.strings;\n\t\tconst controls = reader.settings;\n\t\tconst keys = [\n\t\t\t\"sidebar/close\",\n\t\t\t\"sidebar/contents\",\n\t\t\t\"sidebar/bookmarks\",\n\t\t\t\"sidebar/annotations\",\n\t\t\t\"sidebar/search\",\n\t\t\t\"sidebar/settings\",\n\t\t\t\"sidebar/metadata\"\n\t\t];\n\n\t\tconst container = new UITabbedPanel(\"vertical\").setId(\"sidebar\");\n\n\t\tconst openerBox = new UIDiv().setId(\"btn-p\").addClass(\"box\");\n\t\tconst openerBtn = new UIInput(\"button\");\n\t\topenerBtn.setTitle(strings.get(keys[0]));\n\t\topenerBtn.dom.onclick = (e) => {\n\n\t\t\treader.emit(\"sidebaropener\", false);\n\t\t\te.preventDefault();\n\t\t\topenerBtn.dom.blur();\n\t\t};\n\t\topenerBox.add(openerBtn);\n\t\tcontainer.addMenu(openerBox);\n\n\t\tcontainer.addTab(\"btn-t\", strings.get(keys[1]), new TocPanel(reader));\n\t\tif (controls.bookmarks) {\n\t\t\tcontainer.addTab(\"btn-d\", strings.get(keys[2]), new BookmarksPanel(reader));\n\t\t}\n\t\tif (controls.annotations) {\n\t\t\tcontainer.addTab(\"btn-a\", strings.get(keys[3]), new AnnotationsPanel(reader));\n\t\t}\n\t\tcontainer.addTab(\"btn-s\", strings.get(keys[4]), new SearchPanel(reader));\n\t\tcontainer.addTab(\"btn-c\", strings.get(keys[5]), new SettingsPanel(reader));\n\t\tcontainer.addTab(\"btn-i\", strings.get(keys[6]), new MetadataPanel(reader));\n\t\tcontainer.select(\"btn-t\");\n\n\t\tdocument.body.appendChild(container.dom);\n\n\t\t//-- events --//\n\n\t\treader.on(\"sidebaropener\", (value) => {\n\n\t\t\tif (value) {\n\t\t\t\tcontainer.setClass(\"open\");\n\t\t\t} else {\n\t\t\t\tcontainer.removeAttribute(\"class\");\n\t\t\t}\n\t\t});\n\n\t\treader.on(\"languagechanged\", (value) => {\n\n\t\t\topenerBtn.setTitle(strings.get(keys[0]));\n\t\t\tcontainer.setLabel(\"btn-t\", strings.get(keys[1]));\n\t\t\tif (controls.bookmarks) {\n\t\t\t\tcontainer.setLabel(\"btn-d\", strings.get(keys[2]));\n\t\t\t}\n\t\t\tif (controls.annotations) {\n\t\t\t\tcontainer.setLabel(\"btn-a\", strings.get(keys[3]));\n\t\t\t}\n\t\t\tcontainer.setLabel(\"btn-s\", strings.get(keys[4]));\n\t\t\tcontainer.setLabel(\"btn-c\", strings.get(keys[5]));\n\t\t\tcontainer.setLabel(\"btn-i\", strings.get(keys[6]));\n\t\t});\n\t}\n}","import { uuid } from \"./utils.js\";\nimport { UIBox, UIDiv, UIInput, UILabel } from \"./ui.js\";\n\nexport class NoteDlg {\n\n    constructor(reader) {\n\n        const container = new UIDiv().setId(\"notedlg\");\n        const strings = reader.strings;\n        const keys = [\n            \"notedlg/label\",\n            \"notedlg/add\"\n        ];\n        const label = new UILabel(strings.get(keys[0]), \"note-input\");\n        const textBox = new UIInput(\"text\", \"\").setId(\"note-input\");\n        textBox.dom.oninput = (e) => {\n\n            this.update();\n            e.preventDefault();\n        };\n\n        const addBtn = new UIInput(\"button\", strings.get(keys[1]));\n        addBtn.dom.disabled = true;\n        addBtn.dom.onclick = (e) => {\n\n            const note = {\n                cfi: this.cfi,\n                date: new Date(),\n                text: textBox.getValue(),\n                uuid: uuid()\n            };\n            this.range = undefined;\n            reader.settings.annotations.push(note);\n            reader.emit(\"noteadded\", note);\n            container.removeAttribute(\"class\");\n            e.preventDefault();\n            addBtn.dom.blur();\n        };\n\n        this.update = () => {\n\n            addBtn.dom.disabled = !(this.range && textBox.getValue().length > 0);\n        };\n\n        container.add(new UIBox([label, textBox, addBtn]).addClass(\"control\"));\n        document.body.appendChild(container.dom);\n\n        //-- events --//\n\n        reader.on(\"selected\", (cfi, contents) => {\n\n            this.cfi = cfi;\n            this.range = contents.range(cfi);\n            this.update();\n            container.setClass(\"open\");\n\n            try {\n                const selectedText = this.range.toString().trim();\n                const defaultText = selectedText.length > 20 ?\n                    selectedText.substring(0, 20) + \"...\" :\n                    selectedText;\n                textBox.setValue(defaultText);\n            } catch (error) {\n                console.warn(\"Could not get selected text:\", error);\n                textBox.setValue(\"\");\n            }\n        });\n\n        reader.on(\"unselected\", () => {\n\n            this.range = undefined;\n            this.update();\n            container.removeAttribute(\"class\");\n        });\n\n        reader.on(\"languagechanged\", (value) => {\n\n            label.setTextContent(strings.get(keys[0]));\n            addBtn.setValue(strings.get(keys[1]));\n        });\n    }\n}","import EventEmitter from \"event-emitter\";\n\nimport { extend, detectMobile } from \"./utils.js\";\nimport { Storage } from \"./storage.js\";\nimport { Strings } from \"./strings.js\";\nimport { Toolbar } from \"./toolbar.js\";\nimport { Content } from \"./content.js\";\nimport { Sidebar } from \"./sidebar.js\";\nimport { NoteDlg } from \"./notedlg.js\";\n\nexport class Reader {\n\n\tconstructor(bookPath, settings) {\n\n\t\tconst preinit = (data) => {\n\t\t\tconst url = new URL(window.location);\n\t\t\tlet path = bookPath;\n\t\t\tif (settings && !settings.openbook) {\n\t\t\t\tpath = bookPath;\n\t\t\t\tif (data) this.storage.clear();\n\t\t\t} else if (data && url.search.length === 0) {\n\t\t\t\tpath = data;\n\t\t\t}\n\t\t\tthis.cfgInit(path, settings);\n\t\t\t// Apply initial theme to UI\n\t\t\tthis.applyUITheme(this.settings.theme);\n\t\t\tthis.strings = new Strings(this);\n\t\t\tthis.toolbar = new Toolbar(this);\n\t\t\tthis.content = new Content(this);\n\t\t\tthis.sidebar = new Sidebar(this);\n\t\t\tif (this.settings.annotations) {\n\t\t\t\tthis.notedlg = new NoteDlg(this);\n\t\t\t}\n\t\t\tthis.init();\n\t\t}\n\n\t\tthis.settings = undefined;\n\t\tthis.isMobile = detectMobile();\n\t\tthis.storage = new Storage();\n\t\tconst openbook = settings && settings.openbook;\n\n\t\tif (this.storage.indexedDB && (!settings || openbook)) {\n\t\t\tthis.storage.init(() => this.storage.get((data) => preinit(data)));\n\t\t} else {\n\t\t\tpreinit();\n\t\t}\n\n\t\twindow.onbeforeunload = this.unload.bind(this);\n\t\twindow.onhashchange = this.hashChanged.bind(this);\n\t\twindow.onkeydown = this.keyboardHandler.bind(this);\n\t\twindow.onwheel = (e) => {\n\t\t\tif (e.ctrlKey) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Initialize book.\n\t * @param {*} bookPath\n\t * @param {*} settings\n\t */\n\tinit(bookPath, settings) {\n\n\t\tthis.emit(\"viewercleanup\");\n\t\tthis.navItems = {};\n\n\t\tif (arguments.length > 0) {\n\n\t\t\tthis.cfgInit(bookPath, settings);\n\t\t}\n\n\t\tthis.book = ePub(this.settings.bookPath);\n\t\tthis.rendition = this.book.renderTo(\"viewer\", {\n\t\t\tmanager: this.settings.manager,\n\t\t\tflow: this.settings.flow,\n\t\t\tspread: this.settings.spread.mod,\n\t\t\tminSpreadWidth: this.settings.spread.min,\n\t\t\twidth: \"100%\",\n\t\t\theight: \"100%\",\n\t\t\tsnap: true\n\t\t});\n\n\t\tconst cfi = this.settings.previousLocationCfi;\n\t\tif (cfi) {\n\t\t\tthis.displayed = this.rendition.display(cfi);\n\t\t} else {\n\t\t\tthis.displayed = this.rendition.display();\n\t\t}\n\n\t\tthis.displayed.then((renderer) => {\n\t\t\tthis.emit(\"displayed\", renderer, this.settings);\n\t\t});\n\n\t\tthis.book.ready.then(() => {\n\t\t\tthis.emit(\"bookready\", this.settings);\n\t\t\t// Apply styles (theme + font) after book is ready\n\t\t\tthis.applyStyles();\n\t\t}).then(() => {\n\t\t\tthis.emit(\"bookloaded\");\n\t\t});\n\n\t\tthis.book.loaded.metadata.then((meta) => {\n\t\t\tthis.emit(\"metadata\", meta);\n\t\t});\n\n\t\tthis.book.loaded.navigation.then((toc) => {\n\t\t\tthis.emit(\"navigation\", toc);\n\t\t});\n\n\t\tthis.rendition.on(\"click\", (e) => {\n\t\t\tconst selection = e.view.document.getSelection();\n\t\t\tif (selection.type !== \"Range\") {\n\t\t\t\tthis.emit(\"unselected\");\n\t\t\t}\n\t\t});\n\n\t\tthis.rendition.on(\"layout\", (props) => {\n\t\t\tthis.emit(\"layout\", props);\n\t\t});\n\n\t\tthis.rendition.on(\"selected\", (cfiRange, contents) => {\n\t\t\tthis.setLocation(cfiRange);\n\t\t\tthis.emit(\"selected\", cfiRange, contents);\n\t\t});\n\n\t\tthis.rendition.on(\"relocated\", (location) => {\n\t\t\tthis.setLocation(location.start.cfi);\n\t\t\tthis.emit(\"relocated\", location);\n\t\t\t// Re-inject font when page changes\n\t\t\tconst fontName = this.settings.styles.font === \"default\" ? \"\" : this.settings.styles.font;\n\t\t\tif (fontName) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.injectFontWithRetry(fontName);\n\t\t\t\t}, 200);\n\t\t\t}\n\t\t});\n\n\t\tthis.rendition.on(\"rendered\", () => {\n\t\t\t// Re-inject font when content is rendered\n\t\t\tconst fontName = this.settings.styles.font === \"default\" ? \"\" : this.settings.styles.font;\n\t\t\tif (fontName) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.injectFontWithRetry(fontName);\n\t\t\t\t}, 100);\n\t\t\t}\n\t\t});\n\n\t\tthis.rendition.on(\"keydown\", this.keyboardHandler.bind(this));\n\n\t\tthis.on(\"prev\", () => {\n\t\t\tif (this.book.package.metadata.direction === \"rtl\") {\n\t\t\t\tthis.rendition.next();\n\t\t\t} else {\n\t\t\t\tthis.rendition.prev();\n\t\t\t}\n\t\t});\n\n\t\tthis.on(\"next\", () => {\n\t\t\tif (this.book.package.metadata.direction === \"rtl\") {\n\t\t\t\tthis.rendition.prev();\n\t\t\t} else {\n\t\t\t\tthis.rendition.next();\n\t\t\t}\n\t\t});\n\n\t\tthis.on(\"styleschanged\", (value) => {\n\t\t\tif (!value) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (value.fontSize !== undefined) {\n\t\t\t\tconst fontSize = value.fontSize;\n\t\t\t\tthis.settings.styles.fontSize = fontSize;\n\t\t\t\tthis.rendition.themes.fontSize(fontSize + \"%\");\n\t\t\t}\n\t\t\tif (value.font !== undefined) {\n\t\t\t\tlet font = value.font;\n\t\t\t\tif (font === \"default\") {\n\t\t\t\t\tfont = \"\";\n\t\t\t\t}\n\t\t\t\tthis.settings.styles.font = font;\n\t\t\t\t// Apply styles with new font\n\t\t\t\tthis.applyStyles();\n\t\t\t}\n\t\t});\n\n\t\tthis.on(\"themechanged\", (theme) => {\n\t\t\tthis.settings.theme = theme;\n\t\t\t// Apply UI theme\n\t\t\tthis.applyUITheme(theme);\n\t\t\t// Apply styles with new theme\n\t\t\tthis.applyStyles();\n\t\t});\n\n\t\tthis.on(\"languagechanged\", (language) => {\n\t\t\tthis.settings.language = language;\n\t\t});\n\n\t\tthis.on(\"flowchanged\", (flow) => {\n\t\t\tthis.settings.flow = flow;\n\t\t});\n\n\t\tthis.on(\"spreadchanged\", (spread) => {\n\t\t\tif (spread.mod !== undefined) {\n\t\t\t\tthis.settings.spread.mod = spread.mod;\n\t\t\t\t// Apply spread mode change to rendition\n\t\t\t\tthis.rendition.spread(spread.mod, this.settings.spread.min);\n\t\t\t}\n\t\t\tif (spread.min !== undefined) {\n\t\t\t\tthis.settings.spread.min = spread.min;\n\t\t\t\t// Apply minimum spread width change to rendition\n\t\t\t\tthis.rendition.spread(this.settings.spread.mod, spread.min);\n\t\t\t}\n\t\t});\n\t}\n\n\t/* ------------------------------- Common ------------------------------- */\n\n\t// Helper method to build font URL with configurable assets path\n\tbuildFontUrl(fileName) {\n\t\tconst baseUrl = window.location.origin + window.location.pathname.replace(/\\/[^\\/]*$/, '/');\n\t\tconst assetsPath = this.settings.assetsPath ? this.settings.assetsPath + '/' : '';\n\t\treturn `${baseUrl}${assetsPath}assets/font/${fileName}`;\n\t}\n\n\tapplyUITheme(theme) {\n\t\tdocument.body.className = theme === \"dark\" ? \"dark-theme\" :\n\t\t\t\t\t\t\t\t  theme === \"eyecare\" ? \"eyecare-theme\" : \"\";\n\t}\n\n\tapplyStyles() {\n\t\tif (!this.rendition) return;\n\n\t\tconst theme = this.settings.theme;\n\t\tconst fontName = this.settings.styles.font === \"default\" ? \"\" : this.settings.styles.font;\n\n\t\tconsole.log(`Applying styles - Theme: ${theme}, Font: ${fontName || \"default\"}`);\n\n\t\t// Load font first if needed, then apply styles\n\t\tconst applyStylesWithFont = (actualFontName) => {\n\t\t\tlet contentStyles = {};\n\n\t\t\t// Helper function to add font-family only if font is specified\n\t\t\tconst addFontFamily = (styles, fontName) => {\n\t\t\t\tif (fontName) {\n\t\t\t\t\tstyles[\"font-family\"] = fontName;\n\t\t\t\t}\n\t\t\t\treturn styles;\n\t\t\t};\n\n\t\t\tif (theme === \"dark\") {\n\t\t\t\tcontentStyles = {\n\t\t\t\t\t\"body\": addFontFamily({\n\t\t\t\t\t\t\"background\": \"#1a1a1a\",\n\t\t\t\t\t\t\"color\": \"#e0e0e0 !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"p\": addFontFamily({\n\t\t\t\t\t\t\"color\": \"#e0e0e0 !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"h1, h2, h3, h4, h5, h6\": addFontFamily({\n\t\t\t\t\t\t\"color\": \"#e0e0e0 !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"div\": addFontFamily({}, actualFontName),\n\t\t\t\t\t\"span\": addFontFamily({}, actualFontName),\n\t\t\t\t\t\"a\": addFontFamily({\n\t\t\t\t\t\t\"color\": \"#4a9eff !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"a:visited\": {\n\t\t\t\t\t\t\"color\": \"#b19cd9 !important\"\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t} else if (theme === \"eyecare\") {\n\t\t\t\tcontentStyles = {\n\t\t\t\t\t\"body\": addFontFamily({\n\t\t\t\t\t\t\"background\": \"#f0f4e8\",\n\t\t\t\t\t\t\"color\": \"#2d4a2d !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"p\": addFontFamily({\n\t\t\t\t\t\t\"color\": \"#2d4a2d !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"h1, h2, h3, h4, h5, h6\": addFontFamily({\n\t\t\t\t\t\t\"color\": \"#2d4a2d !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"div\": addFontFamily({}, actualFontName),\n\t\t\t\t\t\"span\": addFontFamily({}, actualFontName),\n\t\t\t\t\t\"a\": addFontFamily({\n\t\t\t\t\t\t\"color\": \"#4a7c4a !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"a:visited\": {\n\t\t\t\t\t\t\"color\": \"#6b8e6b !important\"\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// Light theme\n\t\t\t\tcontentStyles = {\n\t\t\t\t\t\"body\": addFontFamily({\n\t\t\t\t\t\t\"background\": \"#fff\",\n\t\t\t\t\t\t\"color\": \"#000 !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"p\": addFontFamily({\n\t\t\t\t\t\t\"color\": \"#000 !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"h1, h2, h3, h4, h5, h6\": addFontFamily({\n\t\t\t\t\t\t\"color\": \"#000 !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"div\": addFontFamily({}, actualFontName),\n\t\t\t\t\t\"span\": addFontFamily({}, actualFontName),\n\t\t\t\t\t\"a\": addFontFamily({\n\t\t\t\t\t\t\"color\": \"#1a73e8 !important\"\n\t\t\t\t\t}, actualFontName),\n\t\t\t\t\t\"a:visited\": {\n\t\t\t\t\t\t\"color\": \"#8e24aa !important\"\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.rendition.themes.default(contentStyles);\n\n\t\t\tif (actualFontName) {\n\t\t\t\tthis.injectFontWithRetry(actualFontName);\n\t\t\t}\n\n\t\t\tconsole.log(`Applied styles with theme: ${theme}, font: ${actualFontName || \"default\"}`);\n\t\t};\n\n\t\tif (fontName) {\n\t\t\tapplyStylesWithFont(fontName);\n\t\t} else {\n\t\t\tapplyStylesWithFont(\"\");\n\t\t}\n\t}\n\n\t// Enhanced method to inject font with better timing\n\tinjectFontWithRetry(fontName, maxRetries = 3) {\n\t\tif (!fontName || fontName === \"default\") return;\n\n\t\tlet attempts = 0;\n\t\tconst tryInject = () => {\n\t\t\tattempts++;\n\t\t\tconst iframes = document.querySelectorAll('#viewer iframe');\n\n\t\t\tif (iframes.length === 0 && attempts < maxRetries) {\n\t\t\t\tconsole.log(`No iframes found, retrying... (${attempts}/${maxRetries})`);\n\t\t\t\tsetTimeout(tryInject, 200);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet injectedCount = 0;\n\t\t\tiframes.forEach(iframe => {\n\t\t\t\ttry {\n\t\t\t\t\tconst iframeDoc = iframe.contentDocument || iframe.contentWindow.document;\n\t\t\t\t\tif (iframeDoc && iframeDoc.readyState === 'complete') {\n\t\t\t\t\t\t// Create or update the font style element\n\t\t\t\t\t\tlet fontStyleElement = iframeDoc.getElementById('injected-font-style');\n\t\t\t\t\t\tif (!fontStyleElement) {\n\t\t\t\t\t\t\tfontStyleElement = iframeDoc.createElement('style');\n\t\t\t\t\t\t\tfontStyleElement.id = 'injected-font-style';\n\t\t\t\t\t\t\tiframeDoc.head.appendChild(fontStyleElement);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst fontFileMapping = {\n\t\t\t\t\t\t\t\"Huiwen-HKHei\": \"HuiwenGangHei\",\n\t\t\t\t\t\t\t\"Huiwen-Fangsong\": \"HuiwenFangSong\",\n\t\t\t\t\t\t\t\"FZSongKeBenXiuKaiS-R-GB\": \"FangzhengSongJianKe\",\n\t\t\t\t\t\t\t\"Bookerly\": \"Bookerly-Regular\"\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tconst fileName = fontFileMapping[fontName] || fontName;\n\t\t\t\t\t\tconst fontUrl = this.buildFontUrl(`${fileName}.ttf`);\n\n\t\t\t\t\t\t// Inject font-face CSS\n\t\t\t\t\t\tconst fontFaceCSS = `\n\t\t\t\t\t\t\t@font-face {\n\t\t\t\t\t\t\t\tfont-family: '${fontName}';\n\t\t\t\t\t\t\t\tsrc: url('${fontUrl}') format('truetype');\n\t\t\t\t\t\t\t\tfont-weight: normal;\n\t\t\t\t\t\t\t\tfont-style: normal;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t`;\n\n\t\t\t\t\t\tfontStyleElement.textContent = fontFaceCSS;\n\t\t\t\t\t\tinjectedCount++;\n\t\t\t\t\t\tconsole.log(`Injected font ${fontName} into iframe ${injectedCount}`);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.warn(`Failed to inject font into iframe:`, error);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (injectedCount === 0 && attempts < maxRetries) {\n\t\t\t\tconsole.log(`Font injection failed, retrying... (${attempts}/${maxRetries})`);\n\t\t\t\tsetTimeout(tryInject, 200);\n\t\t\t}\n\t\t};\n\n\t\ttryInject();\n\t}\n\n\tnavItemFromCfi(cfi) {\n\n\t\t// This feature was added to solve the problem of duplicate titles in\n\t\t// bookmarks. But this still has no solution because when reloading the\n\t\t// reader, rendition cannot get the range from the previously saved CFI.\n\t\tconst range = this.rendition.getRange(cfi);\n\t\tconst idref = range ? range.startContainer.parentNode.id : undefined;\n\t\tconst location = this.rendition.currentLocation();\n\t\tconst href = location.start.href;\n\t\treturn this.navItems[href + \"#\" + idref] || this.navItems[href];\n\t}\n\n\t/* ------------------------------ Bookmarks ----------------------------- */\n\n\t/**\n\t * Verifying the current page in bookmarks.\n\t * @param {*} cfi\n\t * @returns The index of the bookmark if it exists, or -1 otherwise.\n\t */\n\tisBookmarked(cfi) {\n\n\t\treturn this.settings.bookmarks.indexOf(cfi);\n\t}\n\n\t/* ----------------------------- Annotations ---------------------------- */\n\n\tisAnnotated(note) {\n\n\t\treturn this.settings.annotations.indexOf(note);\n\t}\n\n\t/* ------------------------------ Settings ------------------------------ */\n\n\t/**\n\t * Initialize book settings.\n\t * @param {any} bookPath\n\t * @param {any} settings\n\t */\n\tcfgInit(bookPath, settings) {\n\n\t\tthis.entryKey = md5(bookPath).toString();\n\t\tthis.settings = {\n\t\t\tbookPath: bookPath,\n\t\t\tassetsPath: \"\",\n\t\t\tarrows: this.isMobile ? \"none\" : \"content\", // none | content | toolbar\n\t\t\tmanager: this.isMobile ? \"continuous\" : \"default\",\n\t\t\trestore: true,\n\t\t\thistory: true,\n\t\t\topenbook: this.storage.indexedDB ? true : false,\n\t\t\tlanguage: \"zh\",\n\t\t\ttheme: \"light\",\n\t\t\tsectionId: undefined,\n\t\t\tbookmarks: [],   // array | false\n\t\t\tannotations: [], // array | false\n\t\t\tflow: \"paginated\", // paginated | scrolled\n\t\t\tspread: {\n\t\t\t\tmod: \"auto\", // auto | none\n\t\t\t\tmin: 800\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\tfont: \"default\",\n\t\t\t\tfontSize: 100\n\t\t\t},\n\t\t\tpagination: undefined, // not implemented\n\t\t\tfullscreen: document.fullscreenEnabled\n\t\t};\n\n\t\textend(settings || {}, this.settings);\n\n\t\tif (this.settings.restore) {\n\t\t\tthis.applySavedSettings(settings || {});\n\t\t} else {\n\t\t\tthis.removeSavedSettings();\n\t\t}\n\t}\n\n\t/**\n\t * Checks if the book setting can be retrieved from localStorage.\n\t * @returns true if the book key exists, or false otherwise.\n\t */\n\tisSaved() {\n\n\t\treturn localStorage && localStorage.getItem(this.entryKey) !== null;\n\t}\n\n\t/**\n\t * Removing the current book settings from local storage.\n\t * @returns true if the book settings were deleted successfully, or false\n\t * otherwise.\n\t */\n\tremoveSavedSettings() {\n\n\t\tif (!this.isSaved())\n\t\t\treturn false;\n\n\t\tlocalStorage.removeItem(this.entryKey);\n\t\treturn true;\n\t}\n\n\t/**\n\t * Applies saved settings from local storage.\n\t * @param {*} external External settings\n\t * @returns True if the settings were applied successfully, false otherwise.\n\t */\n\tapplySavedSettings(external) {\n\n\t\tif (!this.isSaved())\n\t\t\treturn false;\n\n\t\tlet stored;\n\t\ttry {\n\t\t\tstored = JSON.parse(localStorage.getItem(this.entryKey));\n\t\t} catch (e) {\n\t\t\tconsole.exception(e);\n\t\t}\n\n\t\tif (stored) {\n\t\t\textend(stored, this.settings, external);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Saving the current book settings in local storage.\n\t */\n\tsaveSettings() {\n\n\t\tthis.settings.previousLocationCfi = this.rendition.location.start.cfi;\n\t\tconst cfg = Object.assign({}, this.settings);\n\t\tdelete cfg.arrows;\n\t\tdelete cfg.manager;\n\t\tdelete cfg.history;\n\t\tdelete cfg.restore;\n\t\tdelete cfg.openbook;\n\t\tdelete cfg.pagination;\n\t\tdelete cfg.fullscreen;\n\t\tlocalStorage.setItem(this.entryKey, JSON.stringify(cfg));\n\t}\n\n\tsetLocation(cfi) {\n\n\t\tconst baseUrl = this.book.archived ? undefined : this.book.url;\n\t\tconst url = new URL(window.location, baseUrl);\n\t\turl.hash = \"#\" + cfi;\n\n\t\t// Update the History Location\n\t\tif (this.settings.history && window.location.hash !== url.hash) {\n\t\t\t// Add CFI fragment to the history\n\t\t\twindow.history.pushState({}, \"\", url);\n\t\t\tthis.currentLocationCfi = cfi;\n\t\t}\n\t}\n\n\t//-- event handlers --//\n\n\tunload() {\n\n\t\tif (this.settings.restore && localStorage) {\n\t\t\tthis.saveSettings();\n\t\t}\n\t}\n\n\thashChanged() {\n\n\t\tconst hash = window.location.hash.slice(1);\n\t\tthis.rendition.display(hash);\n\t}\n\n\tkeyboardHandler(e) {\n\n\t\tconst step = 2;\n\t\tlet value = this.settings.styles.fontSize;\n\n\t\tswitch (e.key) {\n\n\t\t\tcase \"=\":\n\t\t\tcase \"+\":\n\t\t\t\tvalue += step;\n\t\t\t\tthis.emit(\"styleschanged\", { fontSize: value });\n\t\t\t\tbreak;\n\t\t\tcase \"-\":\n\t\t\t\tvalue -= step;\n\t\t\t\tthis.emit(\"styleschanged\", { fontSize: value });\n\t\t\t\tbreak;\n\t\t\tcase \"0\":\n\t\t\t\tvalue = 100;\n\t\t\t\tthis.emit(\"styleschanged\", { fontSize: value });\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowLeft\":\n\t\t\t\tthis.emit(\"prev\");\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowRight\":\n\t\t\t\tthis.emit(\"next\");\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\nEventEmitter(Reader.prototype);"],"names":["module","exports","on","once","off","emit","methods","descriptors","base","d","callable","apply","Function","prototype","call","create","Object","defineProperty","defineProperties","hasOwnProperty","descriptor","configurable","enumerable","writable","type","listener","self","this","arguments","__eeOnceListener__","data","__ee__","value","push","listeners","candidate","i","length","splice","l","args","Array","slice","o","isPrototype","error","keys","isValue","TypeError","forEach","opts1","result","options","src","obj","key","process","possibleTypes","isObject","constructor","String","contains","object","isPlainFunction","assign","normalizeOpts","dscr","c","e","w","desc","gs","get","set","undefined","foo","bar","trzy","fn","indexOf","searchString","str","max","Math","dest","_undefined","val","isFunction","classRe","functionToString","toString","test","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","prop","q","dst","ext","extend","uuid","Date","getTime","replace","r","random","floor","Storage","name","version","db","indexedDB","window","webkitIndexedDB","mozIndexedDB","OIndexedDB","msIndexedDB","console","init","callback","time","now","onerror","request","open","onupgradeneeded","target","objectStoreNames","createObjectStore","onsuccess","log","transaction","objectStore","put","clear","Strings","reader","language","settings","values","en","zh","ERROR_MSG","UIElement","tag","dom","document","createElement","add","argument","appendChild","isArray","j","element","remove","removeChild","Number","isInteger","childNodes","children","lastChild","setId","id","getId","removeAttribute","setClass","className","addClass","classList","removeClass","setStyle","style","getTitle","title","setTitle","getTextContent","textContent","setTextContent","text","getBoundingClientRect","UISpan","super","UIDiv","UIRow","UIPanel","UILabel","htmlFor","UILink","href","setHref","url","UIText","getValue","setValue","UISelect","setMultiple","boolean","multiple","setOptions","selected","option","UIInput","onkeydown","stopPropagation","getName","setName","getType","setType","UINumber","step","min","precision","onchange","setPrecision","setRange","setStep","parseFloat","toFixed","UITabbedPanel","align","tabs","panels","selector","menuDiv","tabsDiv","panelsDiv","addMenu","items","addTab","label","tab","UITab","panel","select","transformSelector","display","setLabel","size","rect","width","transform","height","parent","button","onclick","preventDefault","UIList","expanded","expand","collaps","UIItem","len","box","unselect","UIBox","Toolbar","strings","container","menu1","openerBox","openerBtn","prevBox","prevBtn","nextBox","nextBtn","blur","arrows","menu2","openbookBtn","bookmarkBox","bookmarkBtn","fullscreenBtn","openbook","onload","storage","unload","URL","location","origin","history","pushState","openbookBox","accept","files","FileReader","fr","readAsArrayBuffer","alert","bookmarks","cfi","locationCfi","isBookmarked","fullscreen","fullscreenBox","toggleFullScreen","onfullscreenchange","screen","clientWidth","h","clientHeight","body","start","atStart","atEnd","activeElement","fullscreenElement","documentElement","requestFullscreen","exitFullscreen","Content","prev","viewer","next","loader","divider","overlay","cfg","flow","props","spread","spreadWidth","setTimeout","TocPanel","toc","generateToc","list","chapter","link","item","ibtn","sectionId","rendition","navItems","subitems","subItems","BookmarksPanel","headerLabel","clearBtn","clearBookmarks","update","disabled","renderer","setBookmark","appendBookmark","removeBookmark","_cfi","index","btnr","navItem","navItemFromCfi","idref","spineItem","book","spine","AnnotationsPanel","clearNotes","notes","annotations","note","removeNote","SearchPanel","searchQuery","search","placeholder","onsearch","doSearch","then","results","Promise","all","spineItems","map","load","bind","find","finally","resolve","concat","excerpt","SettingsPanel","languageLabel","languageRow","themeLabel","themeRow","theme","light","dark","eyecare","fontLabel","fontRow","font","fontSizeLabel","fontSizeRow","fontSize","parseInt","flowLabel","flowRow","flowModeStr","paginated","scrolled","mod","minSpreadWidth","spreadLabel","spreadRow","spreadValues","none","auto","minSpreadWidthLabel","minSpreadWidthRow","paginationStr","paginationRow","pagination","styles","MetadataPanel","labels","meta","toUpperCase","innerHTML","Sidebar","controls","NoteDlg","textBox","oninput","addBtn","date","range","contents","selectedText","trim","defaultText","substring","warn","Reader","bookPath","preinit","path","cfgInit","applyUITheme","toolbar","content","sidebar","notedlg","isMobile","some","navigator","userAgent","match","onbeforeunload","onhashchange","hashChanged","keyboardHandler","onwheel","ctrlKey","ePub","renderTo","manager","snap","previousLocationCfi","displayed","ready","applyStyles","loaded","metadata","navigation","view","getSelection","cfiRange","setLocation","fontName","injectFontWithRetry","package","direction","themes","buildFontUrl","fileName","pathname","assetsPath","actualFontName","contentStyles","addFontFamily","default","applyStylesWithFont","maxRetries","attempts","tryInject","iframes","querySelectorAll","injectedCount","iframe","iframeDoc","contentDocument","contentWindow","readyState","fontStyleElement","getElementById","head","fontUrl","fontFaceCSS","getRange","startContainer","parentNode","currentLocation","isAnnotated","entryKey","md5","restore","fullscreenEnabled","applySavedSettings","removeSavedSettings","isSaved","localStorage","getItem","removeItem","external","stored","JSON","parse","exception","saveSettings","setItem","stringify","baseUrl","archived","hash","currentLocationCfi"],"sourceRoot":""}